import{r as k,j as e}from"./ui-D9tbKjPW.js";import{u as Se}from"./useQuery-BDVv3lLJ.js";import{d as be,e as ee,F as He,G as Ke,t as C,I as P,B as y,N as Qe,g as de,f as ve,U as B,m as G,P as he,C as f,b as T,i as z,o as ce,X as ge,c as N,V as fe,S as We,W as Ge,Z as _e,k as te,T as qe,l as Me,Y as Ze,D as Re,w as $e,x as Ae,y as De,_ as Xe,h as Je,$ as Ye,u as es,O as ke}from"./index-DawvkX91.js";import{d as ss}from"./services-B2lohCTD.js";import{f as ae,g as ts,a as as}from"./categories-CJOmrs8V.js";import{T as K}from"./textarea-C-6_aJ3I.js";import{T as Te,a as ze,b as U,c as H}from"./tabs-DVxcWbOM.js";import{S as re,a as ie,b as le,c as ne,d as D}from"./select-Sq8mUarx.js";import{B as M}from"./badge-B7o3n32y.js";import{S as L}from"./star-BTdW7snw.js";import{E as Z}from"./euro-BV2NyTLz.js";import{C as J}from"./calendar-B7PyUKfN.js";import{S as rs}from"./switch-C0mfwCba.js";import{U as Pe}from"./user-plus-Df07eSRU.js";import{L as is}from"./lock-BI-YS4BH.js";import{B as ue}from"./brain-6hsFuRKE.js";import{T as Ce,C as ls}from"./triangle-alert-BVQkYt13.js";import{T as ns}from"./trending-up-BRAOUso5.js";import{A as X}from"./award-DJfn7lq_.js";import{M as Y}from"./message-circle-DNvPG11n.js";import{C as cs}from"./circle-plus-C0p3Nb91.js";import{A as ds}from"./availability-calendar-Boopxsht.js";import{M as Ee}from"./map-pin-BNND_6Zb.js";import{P as os}from"./phone-tE_6A2pp.js";import{C as je}from"./clock-dEzM-vMJ.js";import{C as ms}from"./circle-alert-BB2LRWWr.js";import{F as xs}from"./file-text-D6QFL506.js";import"./vendor-D3F3s8fL.js";import"./index-DLM4OUNl.js";import"./chevron-up-Bdbn_kJE.js";import"./calendar-Cx8WYRfY.js";import"./chevron-left-9Lt4T0L8.js";import"./trash-2-Do3lK0No.js";import"./save-D_QWiiiL.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=be("HandHeart",[["path",{d:"M11 14h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 16",key:"1ifwr1"}],["path",{d:"m7 20 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a2 2 0 0 0-2.75-2.91l-4.2 3.9",key:"17abbs"}],["path",{d:"m2 15 6 6",key:"10dquu"}],["path",{d:"M19.5 8.5c.7-.7 1.5-1.6 1.5-2.7A2.73 2.73 0 0 0 16 4a2.78 2.78 0 0 0-5 1.8c0 1.2.8 2 1.5 2.8L16 12Z",key:"1h3036"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=be("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=be("UsersRound",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]]);function Fe({missionId:d,onSuccess:S}){const{user:h}=ee(),[x,g]=k.useState({amount:"",timeline:"",proposal:""}),m=He("/api/bids",{successMessage:"🚀 Offre envoyée avec succès !",errorContext:"Soumission d'offre",invalidateQueries:[["/api/missions",d],["/api/missions"],["/api/users",h?.id,"bids"]],onSuccess:()=>{g({amount:"",timeline:"",proposal:""}),S()}}),w=Ke({onSubmit:async c=>{m.mutate(c)},validateBeforeSubmit:Qe.validateBid}),i=c=>{if(c.preventDefault(),!h){w.handleError(new Error("Vous devez être connecté pour postuler"),"Authentification requise");return}w.handleSubmit({mission_id:parseInt(d),provider_id:h.id,price:x.amount,timeline_days:x.timeline?parseInt(x.timeline):void 0,message:x.proposal,bid_type:"individual"})},r=(c,j)=>{g(_=>({..._,[c]:j}))};return!h||h.type!=="provider"?null:e.jsx("div",{className:"bg-white rounded-lg p-1",children:e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"amount",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"💰"}),e.jsx("span",{children:"Prix proposé (€)"})]}),e.jsx(P,{id:"amount",type:"number",step:"0.01",min:"0",placeholder:"Ex: 2500",value:x.amount,onChange:c=>r("amount",c.target.value),className:"h-11 rounded-lg border-2 border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-100 transition-colors",required:!0,"data-testid":"input-bid-price"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"timeline",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"⏱️"}),e.jsx("span",{children:"Délai de livraison"})]}),e.jsx(P,{id:"timeline",type:"text",placeholder:"Ex: 4 semaines",value:x.timeline,onChange:c=>r("timeline",c.target.value),className:"h-11 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-colors",required:!0,"data-testid":"input-bid-timeline"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"proposal",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"📝"}),e.jsx("span",{children:"Décrivez votre proposition"})]}),e.jsx(K,{id:"proposal",placeholder:"Expliquez votre approche, votre expérience pertinente et ce que vous allez concrètement livrer pour cette mission...",value:x.proposal,onChange:c=>r("proposal",c.target.value),className:"min-h-[120px] rounded-lg border-2 border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-100 resize-none transition-colors",required:!0,"data-testid":"textarea-bid-proposal"})]}),e.jsx("div",{className:"pt-2",children:e.jsx(y,{type:"submit",className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-3 px-6 rounded-lg text-base shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-[1.02]",disabled:m.isPending||w.isSubmitting,"data-testid":"button-submit-bid",children:m.isPending||w.isSubmitting?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Envoi en cours..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"🚀"}),e.jsx("span",{children:"Envoyer ma candidature"})]})})})]})})}function ps({missionId:d,onSuccess:S}){const{user:h}=ee(),{toast:x}=de(),g=ve(),[m,w]=k.useState(!1),[i,r]=k.useState({amount:"",timeline_days:"",message:""}),[c,j]=k.useState([{name:h?.name||"",role:"Chef d'équipe",experience:"5+ années",isLead:!0,rating:4.5}]),_=()=>{const o={name:"",role:"",experience:"",isLead:!1,rating:4};j([...c,o])},q=(o,v,l)=>{const s=[...c];s[o]={...s[o],[v]:l},j(s)},R=o=>{if(o===0)return;const v=c.filter((l,s)=>s!==o);j(v)},A=async o=>{if(o.preventDefault(),!h){x({title:"Erreur",description:"Vous devez être connecté pour soumettre une offre",variant:"destructive"});return}if(!i.amount||!i.timeline_days||!i.message){x({title:"Erreur",description:"Veuillez remplir tous les champs obligatoires",variant:"destructive"});return}if(c.length<2){x({title:"Erreur",description:"Une équipe doit avoir au moins 2 membres",variant:"destructive"});return}if(c.filter(l=>!l.name||!l.role||!l.experience).length>0){x({title:"Erreur",description:"Veuillez compléter les informations de tous les membres de l'équipe",variant:"destructive"});return}w(!0);try{const l={members:c,total_budget:parseInt(i.amount),estimated_timeline:parseInt(i.timeline_days),description:i.message},p=await(await fe("POST","/api/bids",{mission_id:parseInt(d),price:i.amount,timeline_days:parseInt(i.timeline_days),message:i.message,bid_type:"team",team_composition:l,team_lead_id:h.id})).json();x({title:"✅ Candidature d'équipe soumise !",description:`Votre équipe de ${c.length} membres a été proposée avec succès.`}),g.invalidateQueries({queryKey:["mission-detail",d]}),g.invalidateQueries({queryKey:["missions"]}),S()}catch(l){console.error("Erreur soumission candidature équipe:",l),x({title:"Erreur",description:l instanceof Error?l.message:"Impossible de soumettre la candidature",variant:"destructive"})}finally{w(!1)}};return!h||h.type!=="provider"?null:e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center justify-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Candidature d'équipe"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Présentez votre équipe pré-constituée pour cette mission"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(C,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Composition de l'équipe"]}),e.jsxs(y,{type:"button",variant:"outline",size:"sm",onClick:_,"data-testid":"button-add-member",children:[e.jsx(he,{className:"w-4 h-4 mr-1"}),"Ajouter"]})]}),e.jsx("div",{className:"space-y-3",children:c.map((o,v)=>e.jsxs(f,{className:`${o.isLead?"ring-2 ring-purple-200 bg-purple-50":"bg-gray-50"}`,children:[e.jsx(T,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(z,{className:"text-sm flex items-center gap-2",children:o.isLead?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 text-purple-600"}),"Chef d'équipe"]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4"}),"Membre ",v]})}),!o.isLead&&e.jsx(y,{type:"button",variant:"ghost",size:"sm",onClick:()=>R(v),"data-testid":`button-remove-member-${v}`,children:e.jsx(ge,{className:"w-4 h-4"})})]})}),e.jsxs(N,{className:"pt-0 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(C,{className:"text-sm",children:"Nom complet *"}),e.jsx(P,{placeholder:"Nom du membre",value:o.name,onChange:l=>q(v,"name",l.target.value),disabled:o.isLead,"data-testid":`input-member-name-${v}`})]}),e.jsxs("div",{children:[e.jsx(C,{className:"text-sm",children:"Rôle/Spécialité *"}),e.jsx(P,{placeholder:"Ex: Développeur Frontend",value:o.role,onChange:l=>q(v,"role",l.target.value),"data-testid":`input-member-role-${v}`})]})]}),e.jsxs("div",{children:[e.jsx(C,{className:"text-sm",children:"Expérience *"}),e.jsxs(re,{value:o.experience,onValueChange:l=>q(v,"experience",l),children:[e.jsx(ie,{"data-testid":`select-member-experience-${v}`,children:e.jsx(le,{placeholder:"Niveau d'expérience"})}),e.jsxs(ne,{children:[e.jsx(D,{value:"1-2 années",children:"1-2 années"}),e.jsx(D,{value:"3-5 années",children:"3-5 années"}),e.jsx(D,{value:"5+ années",children:"5+ années"}),e.jsx(D,{value:"10+ années",children:"10+ années"})]})]})]})]})]},v))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(C,{htmlFor:"team-amount",className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Prix total équipe (€) *"]}),e.jsx(P,{id:"team-amount",type:"number",placeholder:"15000",min:"100",value:i.amount,onChange:o=>r(v=>({...v,amount:o.target.value})),"data-testid":"input-team-amount"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Montant global pour toute l'équipe"})]}),e.jsxs("div",{children:[e.jsxs(C,{htmlFor:"team-timeline",className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Délai (jours) *"]}),e.jsx(P,{id:"team-timeline",type:"number",placeholder:"30",min:"1",value:i.timeline_days,onChange:o=>r(v=>({...v,timeline_days:o.target.value})),"data-testid":"input-team-timeline"})]})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"team-message",className:"text-base font-medium",children:"Proposition détaillée *"}),e.jsx(K,{id:"team-message",placeholder:"Décrivez comment votre équipe va réaliser cette mission, la répartition des tâches, votre méthodologie...",rows:5,value:i.message,onChange:o=>r(v=>({...v,message:o.target.value})),"data-testid":"textarea-team-message"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Détaillez la stratégie de votre équipe pour cette mission"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 border",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"Récapitulatif de l'équipe"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Membres:"}),e.jsxs(M,{variant:"secondary",children:[c.length," personnes"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Budget total:"}),e.jsxs(M,{variant:"secondary",children:[i.amount||"0","€"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Délai:"}),e.jsxs(M,{variant:"secondary",children:[i.timeline_days||"0"," jours"]})]})]})]}),e.jsx(y,{type:"submit",className:"w-full bg-purple-600 hover:bg-purple-700",disabled:m,"data-testid":"button-submit-team-bid",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Soumission en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Soumettre la candidature d'équipe"]})})]})}function hs({missionId:d,onSuccess:S}){const{user:h}=ee(),{toast:x}=de(),g=ve(),[m,w]=k.useState(!1),[i,r]=k.useState({name:"",description:"",estimated_budget:"",estimated_timeline_days:"",max_members:"5",visibility:"public",auto_accept:!0}),[c,j]=k.useState([{title:"",description:"",skills:[],min_experience:1,priority:"medium"}]),_=()=>{const l={title:"",description:"",skills:[],min_experience:1,priority:"medium"};j([...c,l])},q=(l,s,p)=>{const b=[...c];b[l]={...b[l],[s]:p},j(b)},R=l=>{if(c.length<=1)return;const s=c.filter((p,b)=>b!==l);j(s)},A=(l,s)=>{if(!s.trim())return;const p=[...c],b=p[l].skills;b.includes(s.trim())||(p[l].skills=[...b,s.trim()],j(p))},o=(l,s)=>{const p=[...c];p[l].skills=p[l].skills.filter((b,Q)=>Q!==s),j(p)},v=async l=>{if(l.preventDefault(),!h){x({title:"Erreur",description:"Vous devez être connecté pour créer une équipe ouverte",variant:"destructive"});return}if(!i.name||!i.description||!i.estimated_budget||!i.estimated_timeline_days){x({title:"Erreur",description:"Veuillez remplir tous les champs obligatoires",variant:"destructive"});return}const s=c.filter(p=>p.title.trim());if(s.length===0){x({title:"Erreur",description:"Veuillez définir au moins un rôle recherché",variant:"destructive"});return}w(!0);try{const b=await(await fe("POST","/api/open-teams",{mission_id:parseInt(d),name:i.name,description:i.description,estimated_budget:parseInt(i.estimated_budget)*100,estimated_timeline_days:parseInt(i.estimated_timeline_days),max_members:parseInt(i.max_members),visibility:i.visibility,auto_accept:i.auto_accept,required_roles:s,members:[{user_id:h.id,name:h.name,role:"Initiateur",experience_years:5,rating:4.5,joined_at:new Date().toISOString()}]})).json();x({title:"🚀 Équipe ouverte créée !",description:`${i.name} est maintenant ouverte au recrutement.`}),g.invalidateQueries({queryKey:["mission-detail",d]}),g.invalidateQueries({queryKey:["open-teams"]}),S()}catch(p){console.error("Erreur création équipe ouverte:",p),x({title:"Erreur",description:p instanceof Error?p.message:"Impossible de créer l'équipe ouverte",variant:"destructive"})}finally{w(!1)}};return!h||h.type!=="provider"?null:e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center justify-center gap-2",children:[e.jsx(O,{className:"w-5 h-5"}),"Créer une équipe ouverte"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Initiez une équipe où d'autres prestataires peuvent vous rejoindre"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"team-name",className:"text-base font-medium",children:"Nom de l'équipe *"}),e.jsx(P,{id:"team-name",placeholder:"Ex: Équipe Développement Web Pro",value:i.name,onChange:l=>r(s=>({...s,name:l.target.value})),"data-testid":"input-team-name"})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"team-description",className:"text-base font-medium",children:"Description de l'équipe *"}),e.jsx(K,{id:"team-description",placeholder:"Décrivez votre approche, votre vision pour cette mission...",rows:3,value:i.description,onChange:l=>r(s=>({...s,description:l.target.value})),"data-testid":"textarea-team-description"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(C,{htmlFor:"estimated-budget",className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Budget estimé (€) *"]}),e.jsx(P,{id:"estimated-budget",type:"number",placeholder:"10000",min:"100",value:i.estimated_budget,onChange:l=>r(s=>({...s,estimated_budget:l.target.value})),"data-testid":"input-estimated-budget"})]}),e.jsxs("div",{children:[e.jsxs(C,{htmlFor:"estimated-timeline",className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Délai estimé (jours) *"]}),e.jsx(P,{id:"estimated-timeline",type:"number",placeholder:"45",min:"1",value:i.estimated_timeline_days,onChange:l=>r(s=>({...s,estimated_timeline_days:l.target.value})),"data-testid":"input-estimated-timeline"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(C,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Rôles recherchés"]}),e.jsxs(y,{type:"button",variant:"outline",size:"sm",onClick:_,"data-testid":"button-add-role",children:[e.jsx(he,{className:"w-4 h-4 mr-1"}),"Ajouter"]})]}),e.jsx("div",{className:"space-y-3",children:c.map((l,s)=>e.jsxs(f,{className:"bg-orange-50 border-orange-200",children:[e.jsx(T,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(z,{className:"text-sm",children:["Rôle ",s+1]}),c.length>1&&e.jsx(y,{type:"button",variant:"ghost",size:"sm",onClick:()=>R(s),"data-testid":`button-remove-role-${s}`,children:e.jsx(ge,{className:"w-4 h-4"})})]})}),e.jsxs(N,{className:"pt-0 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(C,{className:"text-sm",children:"Titre du poste *"}),e.jsx(P,{placeholder:"Ex: Développeur React",value:l.title,onChange:p=>q(s,"title",p.target.value),"data-testid":`input-role-title-${s}`})]}),e.jsxs("div",{children:[e.jsx(C,{className:"text-sm",children:"Priorité"}),e.jsxs(re,{value:l.priority,onValueChange:p=>q(s,"priority",p),children:[e.jsx(ie,{"data-testid":`select-role-priority-${s}`,children:e.jsx(le,{})}),e.jsxs(ne,{children:[e.jsx(D,{value:"high",children:"Haute"}),e.jsx(D,{value:"medium",children:"Moyenne"}),e.jsx(D,{value:"low",children:"Basse"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(C,{className:"text-sm",children:"Description du rôle"}),e.jsx(K,{placeholder:"Décrivez les responsabilités et attentes...",rows:2,value:l.description,onChange:p=>q(s,"description",p.target.value),"data-testid":`textarea-role-description-${s}`})]}),e.jsxs("div",{children:[e.jsx(C,{className:"text-sm",children:"Compétences requises"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:l.skills.map((p,b)=>e.jsxs(M,{variant:"secondary",className:"flex items-center gap-1",children:[p,e.jsx(ge,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>o(s,b)})]},b))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{placeholder:"Ajouter une compétence...",onKeyPress:p=>{p.key==="Enter"&&(p.preventDefault(),A(s,p.currentTarget.value),p.currentTarget.value="")},"data-testid":`input-role-skill-${s}`}),e.jsx(y,{type:"button",variant:"outline",size:"sm",onClick:p=>{const b=p.currentTarget.parentNode?.querySelector("input");b&&(A(s,b.value),b.value="")},children:e.jsx(he,{className:"w-4 h-4"})})]})]})]})]},s))})]}),e.jsxs(f,{className:"bg-gray-50",children:[e.jsx(T,{children:e.jsxs(z,{className:"text-sm flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),"Paramètres de l'équipe"]})}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{className:"text-sm",children:"Nombre max de membres"}),e.jsxs(re,{value:i.max_members,onValueChange:l=>r(s=>({...s,max_members:l})),children:[e.jsx(ie,{"data-testid":"select-max-members",children:e.jsx(le,{})}),e.jsxs(ne,{children:[e.jsx(D,{value:"3",children:"3 membres"}),e.jsx(D,{value:"5",children:"5 membres"}),e.jsx(D,{value:"7",children:"7 membres"}),e.jsx(D,{value:"10",children:"10 membres"})]})]})]}),e.jsxs("div",{children:[e.jsx(C,{className:"text-sm",children:"Visibilité"}),e.jsxs(re,{value:i.visibility,onValueChange:l=>r(s=>({...s,visibility:l})),children:[e.jsx(ie,{"data-testid":"select-visibility",children:e.jsx(le,{})}),e.jsxs(ne,{children:[e.jsx(D,{value:"public",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Publique"]})}),e.jsx(D,{value:"private",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(is,{className:"w-4 h-4"}),"Privée"]})})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rs,{id:"auto-accept",checked:i.auto_accept,onCheckedChange:l=>r(s=>({...s,auto_accept:l})),"data-testid":"switch-auto-accept"}),e.jsx(C,{htmlFor:"auto-accept",className:"text-sm",children:"Accepter automatiquement les candidatures"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-yellow-50 rounded-lg p-4 border",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"Récapitulatif de l'équipe ouverte"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Nom:"}),e.jsx(M,{variant:"secondary",children:i.name||"Non défini"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Budget estimé:"}),e.jsxs(M,{variant:"secondary",children:[i.estimated_budget||"0","€"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Membres max:"}),e.jsxs(M,{variant:"secondary",children:[i.max_members," personnes"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Rôles définis:"}),e.jsxs(M,{variant:"secondary",children:[c.filter(l=>l.title).length," rôles"]})]})]})]}),e.jsx(y,{type:"submit",className:"w-full bg-orange-600 hover:bg-orange-700",disabled:m,"data-testid":"button-submit-open-team",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Création en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Créer l'équipe ouverte"]})})]})}function Ie({missionTitle:d,missionDescription:S,missionBudget:h,missionCategory:x,currentBid:g,providerProfile:m,competitorBids:w=[],onOptimizedBidGenerated:i}){const[r,c]=k.useState(null),[j,_]=k.useState(!1),[q,R]=k.useState(!1),A=async()=>{_(!0),await new Promise(xe=>setTimeout(xe,2e3));const t=o(d+" "+S),n=o(g.proposal),u=v(t,n),I=w.length>0?w.reduce((xe,Ue)=>xe+Ue.price,0)/w.length:h,$=l(g.price,I,h),V=s(m.skills,x,m.completedProjects,m.rating),W=p(g.proposal,m),Ne=(u+V)/2,ye=($+Q(g.timeline))/2,we=W*.4+Ne*.3+ye*.3,Be=b(we,w.length),Le=oe({keywordRelevance:u,priceCompetitiveness:$,experienceMatch:V,proposal:g.proposal}),Ve=me({rating:m.rating,projects:m.completedProjects,skills:m.skills,price:g.price,avgPrice:I}),Oe=se({keywordRelevance:u,priceCompetitiveness:$,proposal:g.proposal,timeline:g.timeline});c({overallScore:we,competitivenessScore:ye,qualityScore:W,matchScore:Ne,winProbability:Be,recommendations:Le,strengths:Ve,weaknesses:Oe,keywordRelevance:u,priceCompetitiveness:$,experienceMatch:V}),_(!1)},o=t=>{const n=["le","la","les","un","une","des","et","ou","mais","donc","or","ni","car"];return t.toLowerCase().split(/[\s,;.!?]+/).filter(u=>u.length>3&&!n.includes(u)).slice(0,10)},v=(t,n)=>{const u=t.filter(I=>n.some($=>$.includes(I)||I.includes($)));return Math.min(100,u.length/t.length*100)},l=(t,n,u)=>t>u?20:t<u*.3?40:t<=n*.9?90:t<=n?75:Math.max(30,70-(t-n)/n*50),s=(t,n,u,I)=>{let $=0;const V=t.filter(W=>W.toLowerCase().includes(n.toLowerCase())||n.toLowerCase().includes(W.toLowerCase()));return $+=V.length/Math.max(t.length,1)*40,$+=Math.min(30,u*.5),$+=I/5*30,Math.min(100,$)},p=(t,n)=>{let u=0;t.length>200&&(u+=25),t.length>500&&(u+=15);const $=["expérience","qualité","deadline","livraison","garantie","suivi"].filter(V=>t.toLowerCase().includes(V));return u+=$.length*5,u+=n.rating/5*20,u+=Math.min(20,n.completedProjects*.2),Math.min(100,u)},b=(t,n)=>{let u=t;return n>5?u*=.8:n>10?u*=.6:n<3&&(u*=1.1),Math.min(95,Math.max(5,u))},Q=t=>{const n=parseInt(t);return n<=7?85:n<=14?75:n<=30?65:45},oe=t=>{const n=[];return t.keywordRelevance<60&&n.push("Incluez plus de mots-clés spécifiques à la mission dans votre proposition"),t.priceCompetitiveness<50&&n.push("Votre prix semble élevé par rapport à la concurrence, justifiez votre valeur ajoutée"),t.proposal.length<300&&n.push("Développez davantage votre proposition pour montrer votre compréhension du projet"),t.experienceMatch<70&&n.push("Mettez en avant votre expérience pertinente dans ce domaine"),n},me=t=>{const n=[];return t.rating>=4.5&&n.push("Excellente réputation client"),t.projects>50&&n.push("Grande expérience avec de nombreux projets"),t.price<t.avgPrice*.9&&n.push("Prix très compétitif"),n},se=t=>{const n=[];return t.keywordRelevance<50&&n.push("Faible correspondance avec les mots-clés de la mission"),t.priceCompetitiveness<40&&n.push("Prix potentiellement trop élevé"),t.proposal.length<200&&n.push("Proposition trop courte"),n},E=()=>{const t=`
Bonjour,

Votre projet "${d}" correspond parfaitement à mon expertise. Avec ${m.completedProjects} projets réalisés et une note de ${m.rating}/5, je peux vous garantir une livraison de qualité.

Mon approche pour votre projet :
• Analyse détaillée de vos besoins spécifiques
• Utilisation de mes compétences en ${m.skills.join(", ")}
• Respect strict des délais convenus
• Communication régulière sur l'avancement
• Garantie satisfaction client

Je propose de réaliser ce projet pour ${Math.round(g.price*.95)}€ avec livraison sous ${g.timeline}.

Ma valeur ajoutée : expérience prouvée dans ${x}, méthodologie rigoureuse et engagement qualité.

Disponible pour échanger sur votre projet dès maintenant.

Cordialement
    `.trim();c(n=>n?{...n,optimizedProposal:t}:null),R(!0),i&&i({...g,proposal:t,price:Math.round(g.price*.95)})},F=t=>t>=80?"text-green-600":t>=60?"text-yellow-600":"text-red-600",a=t=>t>=80?"bg-green-100":t>=60?"bg-yellow-100":"bg-red-100";return e.jsxs(f,{className:"w-full max-w-4xl mx-auto",children:[e.jsx(T,{children:e.jsxs(z,{className:"flex items-center space-x-2",children:[e.jsx(ue,{className:"w-6 h-6 text-blue-600"}),e.jsx("span",{children:"Analyse IA de votre offre"}),e.jsxs(M,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:[e.jsx(_e,{className:"w-3 h-3 mr-1"}),"Smart Algorithm"]})]})}),e.jsxs(N,{className:"space-y-6",children:[!r&&!j&&e.jsx("div",{className:"text-center py-8",children:e.jsxs(y,{onClick:A,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Analyser mon offre avec l'IA"]})}),j&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Analyse en cours avec notre algorithme propriétaire..."})]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`p-6 rounded-xl ${a(r.overallScore)}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Score Global"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`text-3xl font-bold ${F(r.overallScore)}`,children:Math.round(r.overallScore)}),e.jsx("span",{className:"text-gray-500",children:"/100"})]})]}),e.jsx(te,{value:r.overallScore,className:"mb-4"}),e.jsx("div",{className:"flex items-center space-x-4 text-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(qe,{className:"w-4 h-4 mr-1 text-blue-600"}),e.jsxs("span",{children:["Probabilité de succès: ",Math.round(r.winProbability),"%"]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(f,{children:e.jsxs(N,{className:"p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Qualité"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(te,{value:r.qualityScore,className:"flex-1 mr-2"}),e.jsx("span",{className:`font-bold ${F(r.qualityScore)}`,children:Math.round(r.qualityScore)})]})]})}),e.jsx(f,{children:e.jsxs(N,{className:"p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Correspondance"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(te,{value:r.matchScore,className:"flex-1 mr-2"}),e.jsx("span",{className:`font-bold ${F(r.matchScore)}`,children:Math.round(r.matchScore)})]})]})}),e.jsx(f,{children:e.jsxs(N,{className:"p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Compétitivité"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(te,{value:r.competitivenessScore,className:"flex-1 mr-2"}),e.jsx("span",{className:`font-bold ${F(r.competitivenessScore)}`,children:Math.round(r.competitivenessScore)})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(f,{children:[e.jsx(T,{children:e.jsxs(z,{className:"flex items-center text-green-600",children:[e.jsx(Me,{className:"w-5 h-5 mr-2"}),"Forces"]})}),e.jsx(N,{children:e.jsx("ul",{className:"space-y-2",children:r.strengths.map((t,n)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(L,{className:"w-4 h-4 text-green-500 mr-2 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:t})]},n))})})]}),e.jsxs(f,{children:[e.jsx(T,{children:e.jsxs(z,{className:"flex items-center text-orange-600",children:[e.jsx(Ce,{className:"w-5 h-5 mr-2"}),"Points d'amélioration"]})}),e.jsx(N,{children:e.jsx("ul",{className:"space-y-2",children:r.weaknesses.map((t,n)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(Ce,{className:"w-4 h-4 text-orange-500 mr-2 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:t})]},n))})})]})]}),e.jsxs(f,{children:[e.jsx(T,{children:e.jsxs(z,{className:"flex items-center text-blue-600",children:[e.jsx(Ze,{className:"w-5 h-5 mr-2"}),"Recommandations IA"]})}),e.jsx(N,{children:e.jsx("ul",{className:"space-y-3",children:r.recommendations.map((t,n)=>e.jsxs("li",{className:"flex items-start p-3 bg-blue-50 rounded-lg",children:[e.jsx(ns,{className:"w-4 h-4 text-blue-500 mr-2 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:t})]},n))})})]}),e.jsx("div",{className:"text-center",children:e.jsxs(y,{onClick:E,className:"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",disabled:q,children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Générer une proposition optimisée"]})}),q&&r.optimizedProposal&&e.jsxs(f,{className:"border-purple-200 bg-purple-50",children:[e.jsx(T,{children:e.jsx(z,{className:"text-purple-700",children:"Proposition Optimisée par IA"})}),e.jsxs(N,{children:[e.jsx(K,{value:r.optimizedProposal,readOnly:!0,className:"min-h-[200px] bg-white"}),e.jsx("div",{className:"mt-4 text-sm text-purple-600",children:"✨ Cette proposition a été générée pour maximiser vos chances de succès"})]})]})]})]})]})}function gs({mission:d,user:S,sortedBids:h,showAIAnalyzer:x,setShowAIAnalyzer:g,showBidForm:m,setShowBidForm:w}){const[i,r]=k.useState("individual"),[c,j]=k.useState(!1),[_,q]=k.useState(!1);return e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-4 md:p-6 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center",children:e.jsx(X,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm md:text-base",children:"Candidater à cette mission"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:"Choisissez votre mode de candidature"})]})]}),e.jsxs(Te,{value:i,onValueChange:R=>r(R),className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsxs(U,{value:"individual",className:"text-xs md:text-sm data-[testid=tab-individual]","data-testid":"tab-individual",children:[e.jsx(ce,{className:"w-4 h-4 mr-1"}),"Solo"]}),e.jsxs(U,{value:"team",className:"text-xs md:text-sm","data-testid":"tab-team",children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),"Équipe"]}),e.jsxs(U,{value:"open_team",className:"text-xs md:text-sm","data-testid":"tab-open-team",children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Équipe Ouverte"]})]}),e.jsx(H,{value:"individual",className:"space-y-4 mt-0",children:e.jsxs(f,{className:"bg-blue-50 border-blue-200",children:[e.jsx(T,{className:"pb-3",children:e.jsxs(z,{className:"text-sm flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Candidature individuelle"]})}),e.jsxs(N,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Candidatez seul à cette mission avec votre expertise."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(y,{onClick:()=>g(!x),className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-sm",size:"default","data-testid":"button-ai-analyzer",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Analyser avec l'IA"]}),e.jsxs(y,{onClick:()=>w(!m),className:"w-full bg-green-600 hover:bg-green-700 text-sm",size:"default","data-testid":"button-submit-individual",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),m?"Masquer le formulaire":"Soumettre une offre"]})]}),x&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(Ie,{missionTitle:d.title,missionDescription:d.description,missionBudget:parseFloat(d.budget||"0"),missionCategory:d.category,currentBid:{price:0,timeline:"",proposal:""},providerProfile:{rating:4.5,completedProjects:25,skills:["React","Node.js","TypeScript"],portfolio:[]},competitorBids:h,onOptimizedBidGenerated:R=>{w(!0)}})}),m&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(Fe,{missionId:d.id,onSuccess:()=>{w(!1),g(!1)}})})]})]})}),e.jsx(H,{value:"team",className:"space-y-4 mt-0",children:e.jsxs(f,{className:"bg-purple-50 border-purple-200",children:[e.jsx(T,{className:"pb-3",children:e.jsxs(z,{className:"text-sm flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"Candidature d'équipe"]})}),e.jsxs(N,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Candidatez avec une équipe pré-constituée que vous dirigez."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white rounded-lg border",children:[e.jsx(L,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Vous êtes le chef d'équipe"})]}),e.jsxs(y,{onClick:()=>j(!c),className:"w-full bg-purple-600 hover:bg-purple-700 text-sm",size:"default","data-testid":"button-submit-team",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),c?"Masquer le formulaire":"Candidater en équipe"]})]}),c&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(ps,{missionId:d.id,onSuccess:()=>{j(!1)}})})]})]})}),e.jsx(H,{value:"open_team",className:"space-y-4 mt-0",children:e.jsxs(f,{className:"bg-orange-50 border-orange-200",children:[e.jsx(T,{className:"pb-3",children:e.jsxs(z,{className:"text-sm flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"Équipe ouverte"]})}),e.jsxs(N,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Créez une équipe ouverte où d'autres prestataires peuvent vous rejoindre."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[e.jsx(Pe,{className:"w-3 h-3 text-orange-600"}),e.jsx("span",{children:"Recrutement ouvert"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[e.jsx(cs,{className:"w-3 h-3 text-orange-600"}),e.jsx("span",{children:"Collaboration"})]})]}),e.jsxs(y,{onClick:()=>q(!_),className:"w-full bg-orange-600 hover:bg-orange-700 text-sm",size:"default","data-testid":"button-submit-open-team",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),_?"Masquer le formulaire":"Créer une équipe ouverte"]})]}),_&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(hs,{missionId:d.id,onSuccess:()=>{q(!1)}})})]})]})})]})]})}function js({providerId:d,providerName:S,isOpen:h,onClose:x}){const{toast:g}=de(),{data:m,isLoading:w}=Se({queryKey:["/api/providers",d,"profile"],enabled:!!d&&h}),i=r=>Array.from({length:5},(c,j)=>e.jsx(L,{className:`w-4 h-4 ${j<r?"text-yellow-400 fill-current":"text-gray-300"}`},j));return!h||!d?null:e.jsx(Re,{open:h,onOpenChange:x,children:e.jsxs($e,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ae,{children:e.jsx(De,{asChild:!0,children:e.jsx(Xe,{children:"Profil du prestataire"})})}),e.jsx("div",{className:"p-6"}),w?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):m?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-secondary/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:m.name}),e.jsxs("div",{className:"flex items-center space-x-4 text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{className:"w-4 h-4 mr-1"}),m.location||"Localisation non spécifiée"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),"Membre depuis ",ae(m.joinedAt)]})]}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:m.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center justify-end mb-2",children:[e.jsx("div",{className:"flex items-center mr-2",children:i(Math.round(parseFloat(m.rating)))}),e.jsx("span",{className:"text-xl font-bold",children:m.rating})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[m.totalProjects," projets réalisés"]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.skills.map((r,c)=>e.jsx(M,{variant:"secondary",children:r},c))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs(y,{className:"bg-blue-500 hover:bg-blue-600 text-white",onClick:()=>{window.location.href=`/messages?contact=${d}&name=${encodeURIComponent(S)}`},children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Message"]}),e.jsxs(y,{variant:"outline",className:"border-green-500 text-green-600 hover:bg-green-50",onClick:()=>{g({title:"Contacter le prestataire",description:`Appelez ${S} pour discuter du projet`})},children:[e.jsx(os,{className:"w-4 h-4 mr-2"}),"Appeler"]}),e.jsxs(y,{className:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white",onClick:()=>{g({title:"Réservation de créneau",description:`Fonctionnalité de réservation avec ${S} en cours de développement`})},children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Réserver un créneau"]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(G,{className:"w-5 h-5 mr-2"}),"Réalisations récentes"]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:m.portfolio.slice(0,4).map(r=>e.jsx(f,{children:e.jsxs(N,{className:"p-4",children:[r.images.length>0&&e.jsx("img",{src:r.images[0],alt:r.title,className:"w-full h-32 object-cover rounded-lg mb-3"}),e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:r.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:r.description}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(M,{variant:"outline",children:r.category}),e.jsx("span",{className:"text-xs text-gray-500",children:ae(r.completedAt)})]})]})},r.id))}),m.portfolio.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Aucune réalisation disponible pour le moment"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(je,{className:"w-5 h-5 mr-2"}),"Disponibilités"]}),e.jsx(f,{children:e.jsx(N,{className:"p-4",children:e.jsx(ds,{readOnly:!0,initialAvailability:m.availability||[]})})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(X,{className:"w-5 h-5 mr-2"}),"Avis clients (",m.evaluations.length,")"]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:m.evaluations.map(r=>e.jsx(f,{children:e.jsxs(N,{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-1",children:[i(r.rating),e.jsx("span",{className:"ml-2 font-medium",children:r.clientName})]}),e.jsx("span",{className:"text-xs text-gray-500",children:ae(r.createdAt)})]})}),e.jsx("p",{className:"text-gray-700 mb-3",children:r.comment}),r.photos&&r.photos.length>0&&e.jsx("div",{className:"flex space-x-2",children:r.photos.slice(0,3).map((c,j)=>e.jsx("img",{src:c,alt:`Photo ${j+1}`,className:"w-16 h-16 object-cover rounded-lg"},j))})]})},r.id))}),m.evaluations.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Aucun avis client pour le moment"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(y,{onClick:x,children:"Fermer"})})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"Profil non trouvé"})})]})})}function bs({bidId:d,bidderName:S,isOpen:h,onClose:x}){const{user:g}=ee(),{toast:m}=de(),w=ve(),[i,r]=k.useState(null),[c,j]=k.useState(""),_=Je({mutationFn:async o=>(await fe("POST","/api/bids/respond",o)).json(),onSuccess:()=>{w.invalidateQueries({queryKey:["/api/missions"]});const o=i==="accept"?"acceptée":i==="reject"?"déclinée":"en négociation";m({title:"Réponse envoyée !",description:`Votre réponse (${o}) a été envoyée au prestataire. Il recevra une notification.`}),setTimeout(()=>{alert(`Confirmation : Votre réponse "${o}" a bien été envoyée à ${S}. Un email de confirmation lui a été envoyé.`)},500),x(),r(null),j("")},onError:o=>{m({title:"Erreur",description:o.message||"Une erreur est survenue",variant:"destructive"})}}),q=o=>{if(o.preventDefault(),!i){m({title:"Action requise",description:"Veuillez choisir une action",variant:"destructive"});return}if(i==="negotiate"&&!c.trim()){m({title:"Message requis",description:"Veuillez ajouter un message pour négocier",variant:"destructive"});return}_.mutate({bidId:d,status:i,message:c.trim()||null,clientResponse:i})},R=o=>{switch(o){case"accept":return`Bonjour ${S},

Nous avons le plaisir de vous informer que votre offre a été retenue pour ce projet. Nous allons procéder à la mise en place du contrat.

Cordialement`;case"reject":return`Bonjour ${S},

Nous vous remercions pour votre offre. Malheureusement, nous avons décidé de retenir une autre proposition pour ce projet.

Cordialement`;case"negotiate":return`Bonjour ${S},

Votre offre nous intéresse. Cependant, nous aimerions discuter de certains points :

- 
- 

Êtes-vous ouvert à la négociation ?

Cordialement`}},A=o=>{r(o),j(R(o))};return e.jsx(Re,{open:h,onOpenChange:x,children:e.jsxs($e,{className:"sm:max-w-2xl bg-white border shadow-lg",children:[e.jsx(Ae,{children:e.jsxs(De,{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Y,{className:"w-6 h-6 text-blue-500"}),"Répondre à l'offre de ",S]})}),e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Choisissez votre réponse :"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>A("accept"),className:`p-4 rounded-xl border-2 transition-all ${i==="accept"?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-green-300"}`,children:[e.jsx(Me,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),e.jsx("div",{className:"font-semibold",children:"Accepter"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Retenir cette offre"})]}),e.jsxs("button",{type:"button",onClick:()=>A("negotiate"),className:`p-4 rounded-xl border-2 transition-all ${i==="negotiate"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-blue-300"}`,children:[e.jsx(Y,{className:"w-8 h-8 mx-auto mb-2 text-blue-500"}),e.jsx("div",{className:"font-semibold",children:"Négocier"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Demander des ajustements"})]}),e.jsxs("button",{type:"button",onClick:()=>A("reject"),className:`p-4 rounded-xl border-2 transition-all ${i==="reject"?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-red-300"}`,children:[e.jsx(ls,{className:"w-8 h-8 mx-auto mb-2 text-red-500"}),e.jsx("div",{className:"font-semibold",children:"Décliner"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Ne pas retenir"})]})]})]}),i&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"message",className:"text-sm font-semibold text-gray-800",children:["Message à ",S]}),e.jsx(K,{id:"message",value:c,onChange:o=>j(o.target.value),placeholder:"Votre message...",className:"min-h-[120px]"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(y,{type:"button",variant:"outline",onClick:x,className:"flex-1",disabled:_.isPending,children:"Annuler"}),e.jsx(y,{type:"submit",className:"flex-1 bg-blue-500 hover:bg-blue-600",disabled:!i||_.isPending,children:_.isPending?"Envoi...":"Envoyer la réponse"})]})]})]})})}function Ys(){console.log("🔍 MissionDetailPage - Démarrage du composant");const{user:d}=ee(),S=Ye(),[,h]=es(),x=S.id;console.log("🔍 MissionDetailPage - Params reçus:",{missionId:x,user:d?.name});const[g,m]=k.useState("overview"),[w,i]=k.useState(null),[r,c]=k.useState(""),[j,_]=k.useState(null),[q,R]=k.useState(""),[A,o]=k.useState(!1),[v,l]=k.useState(!1),{data:s,isLoading:p,error:b}=Se({queryKey:["mission-detail",x],queryFn:async()=>{if(console.log("🔍 Chargement mission avec mappers ID:",x),!x||x==="undefined"||x==="null")throw new Error("ID de mission invalide");try{const a=await ss.feed.getMissionById(x);return console.log("✅ Mission normalisée chargée:",a.title),a}catch(a){throw console.error("❌ Erreur lors du chargement de la mission:",a),a}},enabled:!!x,retry:1,retryDelay:2e3,staleTime:3e4});k.useEffect(()=>{if(s){document.title=`${s.title} - SwipDEAL`;const a=document.querySelector('meta[name="description"]');a&&a.setAttribute("content",`Mission: ${s.title} - Budget: ${s.budgetDisplay} - ${s.description.slice(0,150)}...`)}},[s]);const Q=()=>{if(!s||!d)return"overview";const t=[...s.bids||[]].sort((u,I)=>u.amount-I.amount),n=s.teamRequirements&&s.teamRequirements.length>0;return d.type==="client"&&s.clientName===d.name&&t.length>0?"bids":n&&d.type==="provider"&&s.clientName!==d.name?"team":"overview"};k.useEffect(()=>{if(console.log("🔄 useEffect - Mission ou user changé:",{missionId:s?.id,userId:d?.id,missionExists:!!s}),s){const a=Q();console.log("📊 Onglet par défaut calculé:",a),m(a),i(null),c(""),_(null),R(""),o(!1),l(!1)}},[s?.id,d?.id,s,d]);const oe=a=>{m(a),console.log(`📊 Navigation vers l'onglet: ${a} pour mission ${s?.id}`)},me=a=>{const t=parseFloat(a);return Array.from({length:5},(n,u)=>e.jsx(L,{className:`w-4 h-4 ${u<Math.floor(t)?"text-yellow-400 fill-current":"text-gray-300 dark:text-gray-600"}`},u))};if(console.log("🔍 MissionDetailPage - État du rendu:",{isLoading:p,hasError:!!b,hasMission:!!s,missionId:s?.id}),p)return console.log("⏳ MissionDetailPage - Affichage du loading"),e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsx("div",{className:"flex items-center justify-center min-h-[300px]",children:e.jsxs("div",{className:"flex flex-col items-center gap-6",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Chargement de la mission"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Récupération des détails..."})]})]})})})});if(b||!s)return console.error("❌ MissionDetailPage - Erreur ou mission manquante:",{error:b instanceof Error?b.message:b,mission:s,missionId:x,hasError:!!b,hasMission:!!s,stack:b instanceof Error?b.stack:void 0}),e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs("div",{className:"text-center mt-20",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-6 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center",children:e.jsx(ms,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-3",children:"Mission introuvable"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:b instanceof Error?b.message:"Cette mission n'existe plus ou a été supprimée."}),!1,e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(y,{onClick:()=>window.location.reload(),variant:"outline",children:"Recharger"}),e.jsxs(y,{onClick:()=>h("/provider-profile"),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Retour au marketplace"]})]})]})})});console.log("✅ MissionDetailPage - Mission chargée, préparation du rendu:",s.title);const se=s?ts(s.category):null,E=s?.bids?[...s.bids].sort((a,t)=>a.amount-t.amount):[],F=s?.teamRequirements&&Array.isArray(s.teamRequirements)&&s.teamRequirements.length>0;return console.log("🔍 Team Mission Check:",{hasTeamRequirements:!!s?.teamRequirements,teamRequirementsLength:s?.teamRequirements?.length,isTeamMission:F}),e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(y,{onClick:()=>h("/provider-profile"),variant:"ghost",className:"flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-800","data-testid":"button-back-marketplace",children:[e.jsx(ke,{className:"w-4 h-4"}),"Retour au marketplace"]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"w-4 h-4"}),E.length," candidature",E.length!==1?"s":""]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-4 h-4"}),s.createdAt?ae(s.createdAt):"Date non spécifiée"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-3","data-testid":"text-mission-title",children:s.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1","data-testid":"text-client-name",children:[e.jsx(ce,{className:"w-4 h-4"}),s.clientName]}),e.jsxs("span",{className:"flex items-center gap-1","data-testid":"text-budget",children:[e.jsx(Z,{className:"w-4 h-4"}),s.budgetDisplay]}),se&&e.jsx(M,{variant:"secondary",className:"text-xs","data-testid":"badge-category",children:se.name})]})]})]})}),e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs(Te,{value:g,onValueChange:oe,className:"w-full",children:[e.jsxs(ze,{className:`w-full bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-2 mb-8 ${F?"grid":"flex"} gap-3`,style:F&&s.teamRequirements?{gridTemplateColumns:`repeat(${2+s.teamRequirements.length}, 1fr)`}:{},children:[e.jsxs(U,{value:"overview",className:"flex items-center justify-center gap-2 data-[state=active]:bg-blue-50 data-[state=active]:text-blue-600 dark:data-[state=active]:bg-blue-900/30 dark:data-[state=active]:text-blue-400 text-sm px-4 py-3 font-medium","data-testid":"tab-overview",children:[e.jsx(xs,{className:"w-4 h-4"}),e.jsx("span",{children:"Détails"})]}),F&&s.teamRequirements?.map((a,t)=>e.jsxs(U,{value:`specialty-${t}`,className:"flex items-center justify-center gap-2 data-[state=active]:bg-purple-50 data-[state=active]:text-purple-600 dark:data-[state=active]:bg-purple-900/30 dark:data-[state=active]:text-purple-400 text-sm px-4 py-3 font-medium","data-testid":`tab-specialty-${t}`,children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate max-w-[120px]",title:a.profession,children:a.profession}),a.is_lead_role&&e.jsx(L,{className:"w-3 h-3 text-yellow-500"})]},t)),e.jsxs(U,{value:"bids",className:"flex items-center justify-center gap-2 data-[state=active]:bg-blue-50 data-[state=active]:text-blue-600 dark:data-[state=active]:bg-blue-900/30 dark:data-[state=active]:text-blue-400 text-sm px-4 py-3 font-medium min-w-[120px]","data-testid":"tab-bids",children:[e.jsx(us,{className:"w-4 h-4"}),e.jsx("span",{children:"Offres"}),e.jsx(M,{variant:"secondary",className:"text-xs ml-1",children:E.length})]})]}),e.jsxs(H,{value:"overview",className:"space-y-6","data-testid":"content-overview",children:[e.jsxs(f,{children:[e.jsx(T,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-blue-600"}),"Description du projet"]})}),e.jsx(N,{children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed","data-testid":"text-description",children:s.description})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(f,{children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Z,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Budget"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400","data-testid":"text-budget-amount",children:s.budgetDisplay})]})]})})}),e.jsx(f,{children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Ee,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Localisation"}),e.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white","data-testid":"text-location",children:s.location||"Non spécifié"})]})]})})}),e.jsx(f,{children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center",children:e.jsx(B,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Candidatures"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400","data-testid":"text-bids-count",children:E.length})]})]})})})]}),d&&d.type==="provider"&&s.clientName!==d.name&&e.jsx(gs,{mission:s,user:d,sortedBids:E,showAIAnalyzer:v,setShowAIAnalyzer:l,showBidForm:A,setShowBidForm:o}),d&&d.type==="provider"&&s.clientName===d.name&&e.jsx(f,{className:"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700",children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(pe,{className:"w-4 h-4 text-white"})}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300 font-medium",children:"Ceci est votre mission"})]})})})]}),e.jsx(H,{value:"bids",className:"space-y-6","data-testid":"content-bids",children:E.length===0?e.jsx(f,{children:e.jsxs(N,{className:"p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(B,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-3",children:"Aucune candidature"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Cette mission n'a pas encore reçu d'offres de prestataires"})]})}):e.jsx("div",{className:"space-y-6",children:E.map((a,t)=>e.jsx(f,{className:"hover:shadow-md transition-all duration-200","data-testid":`card-bid-${a.id}`,children:e.jsxs(N,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center text-white font-bold text-lg",children:a.providerName.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors",onClick:()=>{i(a.providerId),c(a.providerName)},"data-testid":`text-provider-${a.id}`,children:a.providerName}),t===0&&E.length>1&&e.jsx(M,{className:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",children:"Meilleure offre"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center",children:me("5.0")}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"5.0/5"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400 mb-1","data-testid":`text-bid-amount-${a.id}`,children:typeof a.amount=="string"?`${a.amount}€`:as(a.amount.toString())}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[e.jsx(je,{className:"w-4 h-4"}),a.timeline_days?`${a.timeline_days} jours`:"Non spécifié"]})]})]}),a.message&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed","data-testid":`text-bid-message-${a.id}`,children:a.message})}),d&&s.clientName===d.name&&e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs(y,{onClick:()=>{_(a.id),R(a.providerName)},variant:"outline",className:"flex items-center gap-2","data-testid":`button-contact-${a.id}`,children:[e.jsx(Y,{className:"w-4 h-4"}),"Contacter"]}),e.jsxs(y,{className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2","data-testid":`button-accept-${a.id}`,children:[e.jsx(pe,{className:"w-4 h-4"}),"Accepter l'offre"]})]})]})},a.id))})}),F&&s.teamRequirements?.map((a,t)=>e.jsx(H,{value:`specialty-${t}`,className:"space-y-6","data-testid":`content-specialty-${t}`,children:e.jsxs(f,{className:"bg-gradient-to-br from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 border-purple-200 dark:border-purple-700",children:[e.jsxs(T,{children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsx("div",{className:"flex-1",children:e.jsxs(z,{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-14 h-14 bg-purple-600 dark:bg-purple-500 rounded-xl flex items-center justify-center text-white font-bold text-2xl shadow-lg",children:t+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.profession}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[a.is_lead_role&&e.jsxs(M,{className:"bg-purple-600 text-white",children:[e.jsx(L,{className:"w-3 h-3 mr-1"}),"Lead de l'équipe"]}),e.jsx(M,{variant:a.importance==="high"?"destructive":a.importance==="medium"?"default":"secondary",children:a.importance==="high"?"🔥 Prioritaire":a.importance==="medium"?"📌 Important":"💡 Optionnel"})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-6 p-4 bg-white dark:bg-gray-800 rounded-lg border border-purple-200 dark:border-purple-700",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[a.estimated_budget.toLocaleString(),"€"]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Budget alloué"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[a.estimated_days,"j"]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Durée estimée"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:[a.min_experience,"+"]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Années d'exp."})]})]})]}),e.jsxs(N,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-purple-600"}),"Description du rôle"]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:a.description})]}),a.required_skills&&a.required_skills.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5 text-purple-600"}),"Compétences requises"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.required_skills.map((n,u)=>e.jsx(M,{variant:"outline",className:"bg-white dark:bg-gray-800 text-base py-2 px-3",children:n},u))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-purple-600"}),"Détails de la mission"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(f,{className:"bg-white dark:bg-gray-800",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Z,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Budget"}),e.jsxs("p",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:[a.estimated_budget,"€"]})]})]})})}),e.jsx(f,{className:"bg-white dark:bg-gray-800",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:e.jsx(je,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Durée"}),e.jsxs("p",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:[a.estimated_days," jours"]})]})]})})}),e.jsx(f,{className:"bg-white dark:bg-gray-800",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center",children:e.jsx(X,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Expérience min."}),e.jsxs("p",{className:"text-xl font-bold text-purple-600 dark:text-purple-400",children:[a.min_experience," an",a.min_experience>1?"s":""]})]})]})})})]})]}),d&&d.type==="provider"&&s.clientName!==d.name&&e.jsxs("div",{className:"pt-4 border-t border-purple-200 dark:border-purple-700",children:[e.jsxs(y,{className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-semibold text-lg py-6",onClick:()=>{console.log("Candidature pour le rôle:",a.profession),o(!0)},"data-testid":`button-apply-specialty-${t}`,children:[e.jsx(pe,{className:"w-5 h-5 mr-2"}),"Postuler pour ce rôle"]}),e.jsxs("p",{className:"text-sm text-center text-gray-600 dark:text-gray-400 mt-3",children:["💰 ",a.estimated_budget,"€ • ⏱️ ",a.estimated_days," jours • 🎯 ",a.min_experience," an",a.min_experience>1?"s":""," d'expérience"]})]}),d&&s.clientName===d.name&&e.jsx("div",{className:"pt-4 border-t border-purple-200 dark:border-purple-700",children:e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:[e.jsx(X,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-purple-700 dark:text-purple-300",children:"Vous avez créé cette mission"}),e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:`Les candidatures pour ce rôle apparaîtront dans l'onglet "Offres"`})]})]})}),s.teamRequirements&&s.teamRequirements.length>1&&e.jsxs("div",{className:"pt-4 border-t border-purple-200 dark:border-purple-700",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"Autres rôles de l'équipe (",s.teamRequirements.length-1,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:s.teamRequirements.map((n,u)=>u!==t&&e.jsxs("button",{onClick:()=>m(`specialty-${u}`),className:"flex items-center gap-2 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:border-purple-400 hover:shadow-md transition-all text-left","data-testid":`button-other-specialty-${u}`,children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center text-purple-600 dark:text-purple-400 font-bold text-sm",children:u+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-white truncate",children:n.profession}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[n.estimated_budget,"€ • ",n.estimated_days,"j"]})]}),n.is_lead_role&&e.jsx(L,{className:"w-4 h-4 text-yellow-500 shrink-0"})]},u))})]})]})]})},t))]})}),e.jsx(js,{providerId:w,providerName:r,isOpen:!!w,onClose:()=>{i(null),c("")}}),e.jsx(bs,{bidId:j,bidderName:q,isOpen:!!j,onClose:()=>{_(null),R("")}}),A&&x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsx(Fe,{missionId:x,onSuccess:()=>{o(!1),window.location.reload()}})})}),v&&s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Analyse IA de la mission"}),e.jsx(y,{onClick:()=>l(!1),variant:"ghost",size:"sm",children:"✕"})]}),e.jsx(Ie,{missionTitle:s.title,missionDescription:s.description,missionBudget:s.budget||0,missionCategory:s.category,currentBid:{price:0,timeline:"À définir",proposal:""},providerProfile:{rating:5,completedProjects:0,skills:[],portfolio:[]},onRecommendationApplied:()=>{l(!1),o(!0)}})]})})})]})}export{Ys as default};
