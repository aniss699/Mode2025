import{F as m,r as E,j as e}from"./ui-BcXBiFQq.js";import{u as F,a as S,B as l,N as k,H as h,C as A,b as T,h as R,j as z,d as B}from"./index-wATDdy4A.js";import{d as D}from"./services-B2lohCTD.js";import{B as u}from"./badge-BHrgIy7C.js";import{A as g,a as j}from"./alert-DZLjVtBe.js";import{C as p}from"./circle-alert-B-ERhT29.js";import{R as N}from"./refresh-cw-CLMxQyf9.js";import{T as O}from"./trash-2-BAokp_Nc.js";import{C as L}from"./calendar-CYq9U2CR.js";import{E as _}from"./euro-Bc4Yw5D-.js";import{M as I}from"./map-pin-Cu-NOTvN.js";import"./vendor-D3F3s8fL.js";const y=s=>{let t;const r=new Set,o=(a,v)=>{const d=typeof a=="function"?a(t):a;if(!Object.is(d,t)){const w=t;t=v??(typeof d!="object"||d===null)?d:Object.assign({},t,d),r.forEach(C=>C(t,w))}},i=()=>t,n={setState:o,getState:i,getInitialState:()=>x,subscribe:a=>(r.add(a),()=>r.delete(a))},x=t=s(o,i,n);return n},V=(s=>s?y(s):y),H=s=>s;function M(s,t=H){const r=m.useSyncExternalStore(s.subscribe,m.useCallback(()=>t(s.getState()),[s,t]),m.useCallback(()=>t(s.getInitialState()),[s,t]));return m.useDebugValue(r),r}const b=s=>{const t=V(s),r=o=>M(t,o);return Object.assign(r,t),r},$=(s=>s?b(s):b),J=$((s,t)=>({favorites:[],loading:!1,error:null,addToFavorites:async r=>{const o=t();if(!o.favorites.some(i=>i.id===r.id)){s({loading:!0,error:null});try{if(!(await fetch("/api/favorites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:1,announcement_id:r.id})})).ok)throw new Error("Erreur lors de l'ajout aux favoris");s({favorites:[...o.favorites,r],loading:!1})}catch(i){console.error("Erreur addToFavorites:",i),s({loading:!1,error:i instanceof Error?i.message:"Erreur inconnue"})}}},removeFromFavorites:async r=>{const o=t();s({loading:!0,error:null});try{if(!(await fetch(`/api/favorites/${r}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:1})})).ok)throw new Error("Erreur lors de la suppression des favoris");s({favorites:o.favorites.filter(c=>c.id!==r),loading:!1})}catch(i){console.error("Erreur removeFromFavorites:",i),s({loading:!1,error:i instanceof Error?i.message:"Erreur inconnue"})}},loadFavorites:async()=>{s({loading:!0,error:null});try{console.log("ðŸ”„ Chargement favoris avec mappers...");const r=await D.getFavorites(1);s({favorites:r,loading:!1}),console.log("âœ… Favoris normalisÃ©s chargÃ©s:",r.length)}catch(r){console.error("Erreur loadFavorites:",r),s({loading:!1,error:r instanceof Error?r.message:"Erreur inconnue",favorites:[]})}},isFavorite:r=>t().favorites.some(o=>o.id===r)})),re=()=>{const[,s]=F(),{user:t}=S(),{favorites:r,loading:o,error:i,loadFavorites:c,removeFromFavorites:f}=J();E.useEffect(()=>{t&&c()},[t,c]);const n=async a=>{await f(a)},x=a=>{s(`/provider-profile?highlight=${a}`)};return t?o?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-gray-600",children:"Chargement de vos favoris..."})]})}):i?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:e.jsxs(g,{variant:"destructive",className:"max-w-md",children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx(j,{children:i}),e.jsxs(l,{onClick:c,className:"mt-4 w-full",children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"RÃ©essayer"]})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex items-center justify-between h-16",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(l,{variant:"ghost",onClick:()=>s("/feed"),className:"flex items-center",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Retour au flux"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"w-6 h-6 text-red-500"}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Mes favoris"}),e.jsx(u,{variant:"secondary",className:"ml-2",children:r.length})]})]})})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:r.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(h,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Aucun favori pour le moment"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Explorez le flux et ajoutez des annonces Ã  vos favoris pour les retrouver ici."}),e.jsx(l,{onClick:()=>s("/feed"),children:"DÃ©couvrir des annonces"})]}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:r.map(a=>e.jsxs(A,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(T,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(R,{className:"text-lg line-clamp-2",children:a.title}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>n(a.id),className:"text-red-500 hover:text-red-700 hover:bg-red-50",children:e.jsx(O,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"w-4 h-4 mr-1"}),a.client_name||"Client anonyme"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),new Date(a.created_at).toLocaleDateString("fr-FR")]})]})]}),e.jsxs(B,{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-700 line-clamp-3",children:a.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"font-semibold text-green-600",children:a.budget?`${a.budget}â‚¬`:"Budget Ã  nÃ©gocier"})]}),a.location&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),a.location]})]}),a.category&&e.jsx(u,{variant:"outline",children:a.category}),e.jsxs("div",{className:"flex space-x-2 pt-2",children:[e.jsx(l,{size:"sm",onClick:()=>x(a.id),className:"flex-1",children:"Voir l'annonce"}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>n(a.id),className:"text-red-500 hover:text-red-700 border-red-200 hover:border-red-300",children:e.jsx(h,{className:"w-4 h-4 fill-red-500"})})]})]})]},a.id))})})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:e.jsxs(g,{className:"max-w-md",children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx(j,{children:"Vous devez Ãªtre connectÃ© pour voir vos favoris."}),e.jsx(l,{onClick:()=>s("/login"),className:"mt-4 w-full",children:"Se connecter"})]})})};export{re as default};
