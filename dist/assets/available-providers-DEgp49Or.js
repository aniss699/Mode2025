import{r as g,j as e}from"./ui-D9tbKjPW.js";import{u as V}from"./useQuery-BYK6sVPC.js";import{B as m,L as c,I as f,C as R,b as Z,f as $,c as O,D as H,E as U,o as q,F as G,q as W,r as J}from"./index-BhnURYFB.js";import{B as K}from"./badge-Df8SQPIc.js";import{C as Q}from"./calendar-CcIbq8S3.js";import{A as X,a as Y,b as _}from"./avatar-BuexAUKP.js";import{T as ee}from"./textarea-_F-cjLwJ.js";import{S as b,a as S,b as N,c as y,d as r}from"./select-Dwtk5ZDs.js";import{C as se}from"./categories-CJOmrs8V.js";import{F as I}from"./filter-CkjrdJ9H.js";import{C as F}from"./calendar-Cai5HkVM.js";import{S as te}from"./star-BdKw_erC.js";import{M as ae}from"./map-pin-D4S-L_zk.js";import{C as P}from"./clock-q3-gwJG4.js";import{M as le}from"./message-circle-DgJO_7RQ.js";import{P as ie}from"./phone-SiEPNsf_.js";import"./vendor-D3F3s8fL.js";import"./en-US-oEpl4HuW.js";import"./chevron-left-C_e4Gn-2.js";import"./index-DLM4OUNl.js";import"./chevron-up-CiItJY8e.js";function ke(){const[l,A]=g.useState(new Date),[w,L]=g.useState(!1),[i,h]=g.useState({category:"all",location:"",maxRate:"",availability:"today"}),[D,j]=g.useState({isOpen:!1,provider:null,selectedTimeSlot:""}),[n,x]=g.useState({date:"",timeSlot:"",duration:"1",description:"",budget:""}),{data:p=[],isLoading:re}=V({queryKey:["/api/providers/available"]}),u=new Date,T=new Date(u);T.setDate(u.getDate()+1),u.toISOString().split("T")[0],T.toISOString().split("T")[0],u.toISOString().split("T")[0],u.toISOString().split("T")[0],T.toISOString().split("T")[0];const k=p.length>0?p:[];console.log("üîç Providers utilis√©s:",{fromAPI:p.length,using:k.length,source:p.length>0?"API":"Mock"});const v=k.filter(s=>{if(i.category!=="all"&&s.category!==i.category||i.location&&!s.location.toLowerCase().includes(i.location.toLowerCase())||i.maxRate&&s.hourlyRate>parseInt(i.maxRate))return!1;if(i.availability==="today"){const a=new Date().toISOString().split("T")[0];return s.availability.some(d=>d.date===a)}return!0}),C=(s,a)=>{if(!a||isNaN(a.getTime()))return[];const d=a.toISOString().split("T")[0];return s.availability.find(t=>t.date===d)?.timeSlots||[]},M=l&&!isNaN(l.getTime())?l.toISOString().split("T")[0]:new Date().toISOString().split("T")[0],B=v.filter(s=>s.availability.some(a=>a.date===M)),z=(s,a)=>{const d=l&&!isNaN(l.getTime())?l.toISOString().split("T")[0]:new Date().toISOString().split("T")[0];j({isOpen:!0,provider:s,selectedTimeSlot:""}),x({date:d,timeSlot:"",duration:"1",description:"",budget:""})},E=()=>{console.log("R√©servation:",{provider:D.provider?.id,...n}),j({isOpen:!1,provider:null,selectedTimeSlot:""})};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Prestataires Disponibles"}),e.jsx("p",{className:"text-lg text-gray-600",children:"Trouvez des professionnels disponibles imm√©diatement avec leurs cr√©neaux et tarifs"})]}),e.jsxs("div",{className:"grid lg:grid-cols-4 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs(m,{onClick:()=>L(!w),variant:"outline",className:"w-full gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),"Filtres",w?e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),w&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(I,{className:"w-4 h-4 text-blue-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Filtres de recherche"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-medium text-gray-600 mb-1 block",children:"Cat√©gorie"}),e.jsxs(b,{value:i.category,onValueChange:s=>h(a=>({...a,category:s})),children:[e.jsx(S,{className:"h-8",children:e.jsx(N,{placeholder:"Toutes les cat√©gories"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"Toutes les cat√©gories"}),se.map(s=>e.jsx(r,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-medium text-gray-600 mb-1 block",children:"Localisation"}),e.jsx(f,{placeholder:"Ville, r√©gion...",value:i.location,onChange:s=>h(a=>({...a,location:s.target.value})),className:"h-8"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-medium text-gray-600 mb-1 block",children:"Tarif maximum"}),e.jsx(f,{type:"number",placeholder:"‚Ç¨/heure",value:i.maxRate,onChange:s=>h(a=>({...a,maxRate:s.target.value})),className:"h-8"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-medium text-gray-600 mb-1 block",children:"Disponibilit√©"}),e.jsxs(b,{value:i.availability,onValueChange:s=>h(a=>({...a,availability:s})),children:[e.jsx(S,{className:"h-8",children:e.jsx(N,{placeholder:"P√©riode"})}),e.jsxs(y,{children:[e.jsx(r,{value:"today",children:"Aujourd'hui"}),e.jsx(r,{value:"week",children:"Cette semaine"}),e.jsx(r,{value:"all",children:"Toutes les disponibilit√©s"})]})]})]}),e.jsx(m,{variant:"outline",size:"sm",className:"w-full h-8",onClick:()=>h({category:"all",location:"",maxRate:"",availability:"today"}),children:"R√©initialiser les filtres"})]})]}),e.jsxs(R,{children:[e.jsx(Z,{children:e.jsxs($,{className:"flex items-center",children:[e.jsx(F,{className:"w-5 h-5 mr-2"}),"S√©lectionner une date"]})}),e.jsxs(O,{children:[e.jsx(Q,{mode:"single",selected:l,onSelect:s=>s&&A(s),disabled:s=>s<new Date(new Date().setHours(0,0,0,0)),className:"rounded-md border"}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:[B.length," prestataire(s) disponible(s) le ",l.toLocaleDateString("fr-FR")]})]})]})]}),e.jsxs("div",{className:"lg:col-span-3",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[v.length," prestataires trouv√©s"]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Tri√©s par disponibilit√© et note"})]}),e.jsx("div",{className:"space-y-6",children:v.map(s=>{const a=C(s,new Date),d=C(s,l);return e.jsx(R,{className:"hover:shadow-lg transition-shadow",children:e.jsx(O,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4 mb-4 lg:mb-0",children:[e.jsxs(X,{className:"w-16 h-16",children:[e.jsx(Y,{src:s.avatar,alt:s.name}),e.jsx(_,{children:s.name.split(" ").map(t=>t[0]).join("")})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"text-xl font-semibold",children:s.name}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(te,{className:"w-4 h-4 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-sm font-medium ml-1",children:s.rating})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),s.location]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"w-4 h-4 mr-1"}),"R√©pond en ",s.responseTime]}),e.jsxs("div",{children:[s.completedProjects," projets"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:s.skills.map(t=>e.jsx(K,{variant:"secondary",className:"text-xs",children:t},t))}),e.jsxs("div",{className:"text-2xl font-bold text-green-600 mb-2",children:[s.hourlyRate,"‚Ç¨/h"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Dernier vu: ",s.lastSeen?new Date(s.lastSeen).toLocaleDateString():"R√©cemment"]}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Membre depuis ",s.memberSince?new Date(s.memberSince).getFullYear():"2024"]})]})]}),e.jsxs("div",{className:"lg:text-right space-y-3",children:[a.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-green-600 mb-1",children:"‚úÖ Disponible aujourd'hui"}),e.jsx("div",{className:"text-xs text-gray-600",children:a.join(", ")})]}),d.length>0&&l.toDateString()!==new Date().toDateString()&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-blue-600 mb-1",children:["üìÖ Disponible le ",l.toLocaleDateString("fr-FR")]}),e.jsx("div",{className:"text-xs text-gray-600",children:d.join(", ")})]}),e.jsxs("div",{className:"flex space-x-2 flex-wrap",children:[e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>window.location.href=`/messages?provider=${s.id}`,children:[e.jsx(le,{className:"w-4 h-4 mr-1"}),"Message"]}),e.jsxs(m,{size:"sm",variant:"outline",className:"border-green-600 text-green-600 hover:bg-green-50",onClick:()=>window.open(`tel:+33${Math.floor(Math.random()*1e9)}`,"_self"),children:[e.jsx(ie,{className:"w-4 h-4 mr-1"}),"Contacter"]}),e.jsxs(H,{open:D.isOpen&&D.provider?.id===s.id,onOpenChange:t=>!t&&j({isOpen:!1,provider:null,selectedTimeSlot:""}),children:[e.jsx(U,{asChild:!0,children:e.jsxs(m,{size:"sm",className:"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white",onClick:()=>z(s),children:[e.jsx(F,{className:"w-4 h-4 mr-1"}),"R√©server"]})}),e.jsxs(q,{className:"max-w-md",children:[e.jsxs(G,{children:[e.jsx(W,{children:"R√©server un cr√©neau"}),e.jsxs(J,{children:["R√©servez un cr√©neau avec ",s.name]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"date",children:"Date"}),e.jsx(f,{id:"date",type:"date",value:n.date,onChange:t=>x(o=>({...o,date:t.target.value})),min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"timeSlot",children:"Cr√©neaux disponibles"}),e.jsxs(b,{value:n.timeSlot,onValueChange:t=>x(o=>({...o,timeSlot:t})),children:[e.jsx(S,{children:e.jsx(N,{placeholder:"S√©lectionner un cr√©neau"})}),e.jsx(y,{children:n.date&&C(s,new Date(n.date)).map(t=>e.jsx(r,{value:t,children:t},t))})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"duration",children:"Dur√©e (heures)"}),e.jsxs(b,{value:n.duration,onValueChange:t=>x(o=>({...o,duration:t})),children:[e.jsx(S,{children:e.jsx(N,{})}),e.jsxs(y,{children:[e.jsx(r,{value:"1",children:"1 heure"}),e.jsx(r,{value:"2",children:"2 heures"}),e.jsx(r,{value:"4",children:"4 heures"}),e.jsx(r,{value:"8",children:"Journ√©e compl√®te"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"budget",children:"Budget estim√©"}),e.jsx(f,{id:"budget",type:"number",placeholder:`${s.hourlyRate*parseInt(n.duration)}‚Ç¨`,value:n.budget,onChange:t=>x(o=>({...o,budget:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"description",children:"Description du projet"}),e.jsx(ee,{id:"description",placeholder:"D√©crivez bri√®vement votre projet...",value:n.description,onChange:t=>x(o=>({...o,description:t.target.value}))})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(m,{variant:"outline",className:"flex-1",onClick:()=>j({isOpen:!1,provider:null,selectedTimeSlot:""}),children:"Annuler"}),e.jsx(m,{className:"flex-1 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",onClick:E,children:"Confirmer la r√©servation"})]})]})]})]})]})]})]})})},s.id)})}),v.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun prestataire disponible"}),e.jsx("p",{className:"text-gray-600",children:"Essayez de modifier vos crit√®res de recherche"})]})]})]})]})}export{ke as default};
