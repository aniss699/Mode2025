import{F as u,r as F,j as r}from"./ui-D9tbKjPW.js";import{n as g,u as M,a as T,B as l,H as m,c as v,b as C,r as I,s as A,w as $,d as z}from"./index-C0DtnMbx.js";import{A as y,a as w}from"./alert-CSjb7ioq.js";import{C as j}from"./circle-alert-DyFHaJIa.js";import{A as R}from"./arrow-left-DRrcWAtJ.js";import{T as O}from"./trash-2-BUePtuLl.js";import{M as P}from"./map-pin-jApUOajy.js";import"./vendor-D3F3s8fL.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=g("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=g("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=g("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),N=e=>{let s;const t=new Set,o=(a,x)=>{const d=typeof a=="function"?a(s):a;if(!Object.is(d,s)){const S=s;s=x??(typeof d!="object"||d===null)?d:Object.assign({},s,d),t.forEach(k=>k(s,S))}},i=()=>s,c={setState:o,getState:i,getInitialState:()=>h,subscribe:a=>(t.add(a),()=>t.delete(a))},h=s=e(o,i,c);return c},q=(e=>e?N(e):N),V=e=>e;function J(e,s=V){const t=u.useSyncExternalStore(e.subscribe,u.useCallback(()=>s(e.getState()),[e,s]),u.useCallback(()=>s(e.getInitialState()),[e,s]));return u.useDebugValue(t),t}const E=e=>{const s=q(e),t=o=>J(s,o);return Object.assign(t,s),t},H=(e=>e?E(e):E);function p(e){const s=e.budget_value_cents?Math.round(e.budget_value_cents/100):e.budget?typeof e.budget=="string"?parseInt(e.budget,10):e.budget:0;return{id:e.id,title:e.title||"",description:e.description||"",category:e.category||"",budget:s,price:s,budgetDisplay:`${s.toLocaleString()}€`,location:e.location||e.location_data?.city||"",clientId:String(e.client_id||e.user_id||""),user_id:e.user_id||e.client_id||null,userId:String(e.user_id||e.client_id||""),clientName:e.clientName||e.client_name||`Client #${e.user_id||e.client_id}`,createdAt:e.createdAt||e.created_at||new Date().toISOString(),status:e.status||"draft",urgency:e.urgency,bids:e.bids?e.bids.map(_):[],teamRequirements:e.teamRequirements||e.team_requirements,is_team_mission:e.is_team_mission||!1,isTeamMode:e.isTeamMode||e.is_team_mission||!1,team_size:e.team_size,deadline:e.deadline}}function _(e){const s=e.amount?typeof e.amount=="string"?parseFloat(e.amount):e.amount:e.price?parseFloat(e.price):0;return{id:e.id,mission_id:e.mission_id,provider_id:e.provider_id||e.providerId,provider_name:e.provider_name||e.providerName||"Prestataire",provider_rating:e.provider_rating||null,amount:s,timeline_days:e.timeline_days||null,message:e.message||null,status:e.status||"pending",bid_type:e.bid_type||"individual",created_at:e.created_at||new Date().toISOString(),updated_at:e.updated_at||null}}function U(e){return{id:e.id,title:e.title||"",description:e.content||"",category:e.category||"",budgetMin:e.budgetMin||e.budget_min,budgetMax:e.budgetMax||e.budget_max,deadline:e.deadline?new Date(e.deadline):void 0,city:e.city||e.location,userId:e.userId||e.user_id,tags:e.tags||[],sponsored:e.sponsored||!1,qualityScore:e.qualityScore||e.quality_score||.8}}const G=p,K={availability:{get:async(e,s,t)=>{const o=new URLSearchParams;s&&o.append("startDate",s),t&&o.append("endDate",t);const i=await fetch(`/api/availability/${e}?${o}`);if(!i.ok)throw new Error("Failed to fetch availability");return i.json()},save:async e=>{const s=await fetch("/api/availability",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({availability:e})});if(!s.ok)throw new Error("Failed to save availability");return s.json()},getSlots:async(e,s)=>{const t=await fetch(`/api/availability/slots/${e}/${s}`);if(!t.ok)throw new Error("Failed to fetch slots");return t.json()},deleteSlot:async e=>{const s=await fetch(`/api/availability/${e}`,{method:"DELETE"});if(!s.ok)throw new Error("Failed to delete slot");return s.json()},getRecurring:async e=>{const s=await fetch(`/api/availability/recurring/${e}`);if(!s.ok)throw new Error("Failed to fetch recurring availability");return s.json()},saveRecurring:async e=>{const s=await fetch("/api/availability/recurring",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error("Failed to save recurring pattern");return s.json()}},feed:{async getMissions(){try{const e=await fetch("/api/missions",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});if(!e.ok){const n=await e.text();throw console.error("❌ Erreur API missions:",e.status,n),new Error(`Erreur ${e.status}: ${e.statusText}`)}const s=await e.json();let t=[],o={total:0};s.missions&&Array.isArray(s.missions)?(t=s.missions,o=s.metadata||{total:s.missions.length}):Array.isArray(s)&&(t=s,o={total:s.length});const i=t.map(n=>p(n));return console.log("✅ Missions normalisées avec mappers:",i.length),{missions:i,metadata:o}}catch(e){console.error("❌ Erreur réseau détaillée:",e);const s=e instanceof Error?e.message:JSON.stringify(e)||"Erreur de connexion inconnue";throw console.error("Type d'erreur:",typeof e),console.error("Stack:",e instanceof Error?e.stack:"N/A"),new Error(`Erreur réseau missions: ${s}`)}},async getUserMissions(e){const s=await fetch(`/api/missions/users/${e}/missions`);if(!s.ok){const i=await s.text();throw console.error("❌ Erreur API missions utilisateur:",s.status,i),new Error(`Erreur ${s.status}: ${s.statusText}`)}const o=(await s.json()).map(i=>p(i));return console.log("✅ Missions utilisateur normalisées:",o.length),o},async getUserBids(e){const s=await fetch(`/api/missions/users/${e}/bids`);if(!s.ok)throw new Error("Failed to fetch user bids");const o=(await s.json()).map(i=>_(i));return console.log("✅ Bids utilisateur normalisés:",o.length),o},async getMissionById(e){if(console.log("🔍 API Service - getMissionById appelé avec ID:",e),!e||e==="undefined"||e==="null")throw console.error("❌ API Service - ID invalide:",e),new Error("ID de mission invalide");const s=await fetch(`/api/missions/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("🔍 API Service - Réponse reçue:",s.status,s.statusText),!s.ok){const i=await s.text();throw console.error("❌ Erreur API mission:",s.status,i),new Error(`Erreur ${s.status}: ${s.statusText}`)}const t=await s.json();console.log("🔍 API Service - Données brutes reçues:",{id:t.id,title:t.title,hasBids:!!t.bids});const o=G(t);return console.log("✅ Mission normalisée:",o.title,"avec",o.bids?.length||0,"offres"),o},async getFeed(e,s=10){try{const{missions:t}=await this.getMissions(),o=t.slice(0,s).map(i=>({id:i.id,title:i.title,description:i.description,category:i.category,budgetMin:i.budget,budgetMax:i.budget,city:i.location,userId:parseInt(i.clientId||"0"),tags:[],sponsored:!1,qualityScore:.8}));return console.log("✅ Feed normalisé depuis missions:",o.length),{items:o,hasMore:t.length>s}}catch(t){throw console.error("❌ Erreur feed:",t),new Error(t instanceof Error?t.message:"Erreur de connexion au feed")}},async getFavorites(e){const s=await fetch(`/api/favorites?user_id=${e}`);if(!s.ok)throw new Error("Erreur lors du chargement des favoris");const i=((await s.json()).favorites||[]).map(n=>U(n));return console.log("✅ Favoris normalisés:",i.length),i}}},Q=H((e,s)=>({favorites:[],loading:!1,error:null,addToFavorites:async t=>{const o=s();if(!o.favorites.some(i=>i.id===t.id)){e({loading:!0,error:null});try{if(!(await fetch("/api/favorites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:1,announcement_id:t.id})})).ok)throw new Error("Erreur lors de l'ajout aux favoris");e({favorites:[...o.favorites,t],loading:!1})}catch(i){console.error("Erreur addToFavorites:",i),e({loading:!1,error:i instanceof Error?i.message:"Erreur inconnue"})}}},removeFromFavorites:async t=>{const o=s();e({loading:!0,error:null});try{if(!(await fetch(`/api/favorites/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:1})})).ok)throw new Error("Erreur lors de la suppression des favoris");e({favorites:o.favorites.filter(n=>n.id!==t),loading:!1})}catch(i){console.error("Erreur removeFromFavorites:",i),e({loading:!1,error:i instanceof Error?i.message:"Erreur inconnue"})}},loadFavorites:async()=>{e({loading:!0,error:null});try{console.log("🔄 Chargement favoris avec mappers...");const t=await K.getFavorites(1);e({favorites:t,loading:!1}),console.log("✅ Favoris normalisés chargés:",t.length)}catch(t){console.error("Erreur loadFavorites:",t),e({loading:!1,error:t instanceof Error?t.message:"Erreur inconnue",favorites:[]})}},isFavorite:t=>s().favorites.some(o=>o.id===t)})),te=()=>{const[,e]=M(),{user:s}=T(),{favorites:t,loading:o,error:i,loadFavorites:n,removeFromFavorites:f}=Q();F.useEffect(()=>{s&&n()},[s,n]);const c=async a=>{await f(a)},h=a=>{e(`/provider-profile?highlight=${a}`)};return s?o?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsxs("div",{className:"text-center",children:[r.jsx(b,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-lg text-gray-600",children:"Chargement de vos favoris..."})]})}):i?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:r.jsxs(y,{variant:"destructive",className:"max-w-md",children:[r.jsx(j,{className:"h-4 w-4"}),r.jsx(w,{children:i}),r.jsxs(l,{onClick:n,className:"mt-4 w-full",children:[r.jsx(b,{className:"w-4 h-4 mr-2"}),"Réessayer"]})]})}):r.jsxs("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("div",{className:"bg-white shadow-sm border-b",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:r.jsx("div",{className:"flex items-center justify-between h-16",children:r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsxs(l,{variant:"ghost",onClick:()=>e("/feed"),className:"flex items-center",children:[r.jsx(R,{className:"w-4 h-4 mr-2"}),"Retour au flux"]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(m,{className:"w-6 h-6 text-red-500"}),r.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Mes favoris"}),r.jsx(v,{variant:"secondary",className:"ml-2",children:t.length})]})]})})})}),r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:t.length===0?r.jsxs("div",{className:"text-center py-12",children:[r.jsx(m,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Aucun favori pour le moment"}),r.jsx("p",{className:"text-gray-600 mb-6",children:"Explorez le flux et ajoutez des annonces à vos favoris pour les retrouver ici."}),r.jsx(l,{onClick:()=>e("/feed"),children:"Découvrir des annonces"})]}):r.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:t.map(a=>r.jsxs(C,{className:"hover:shadow-lg transition-shadow",children:[r.jsxs(I,{className:"pb-3",children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsx(A,{className:"text-lg line-clamp-2",children:a.title}),r.jsx(l,{variant:"ghost",size:"sm",onClick:()=>c(a.id),className:"text-red-500 hover:text-red-700 hover:bg-red-50",children:r.jsx(O,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx($,{className:"w-4 h-4 mr-1"}),a.client_name||"Client anonyme"]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(B,{className:"w-4 h-4 mr-1"}),new Date(a.created_at).toLocaleDateString("fr-FR")]})]})]}),r.jsxs(z,{className:"space-y-4",children:[r.jsx("p",{className:"text-gray-700 line-clamp-3",children:a.description}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(L,{className:"w-4 h-4 text-green-600"}),r.jsx("span",{className:"font-semibold text-green-600",children:a.budget?`${a.budget}€`:"Budget à négocier"})]}),a.location&&r.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[r.jsx(P,{className:"w-4 h-4 mr-1"}),a.location]})]}),a.category&&r.jsx(v,{variant:"outline",children:a.category}),r.jsxs("div",{className:"flex space-x-2 pt-2",children:[r.jsx(l,{size:"sm",onClick:()=>h(a.id),className:"flex-1",children:"Voir l'annonce"}),r.jsx(l,{variant:"outline",size:"sm",onClick:()=>c(a.id),className:"text-red-500 hover:text-red-700 border-red-200 hover:border-red-300",children:r.jsx(m,{className:"w-4 h-4 fill-red-500"})})]})]})]},a.id))})})]}):r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:r.jsxs(y,{className:"max-w-md",children:[r.jsx(j,{className:"h-4 w-4"}),r.jsx(w,{children:"Vous devez être connecté pour voir vos favoris."}),r.jsx(l,{onClick:()=>e("/login"),className:"mt-4 w-full",children:"Se connecter"})]})})};export{te as default};
