function c(e){const r=e.budget_value_cents?Math.round(e.budget_value_cents/100):e.budget?typeof e.budget=="string"?parseInt(e.budget,10):e.budget:0;return{id:e.id,title:e.title||"",description:e.description||"",category:e.category||"",budget:r,budgetDisplay:`${r.toLocaleString()}€`,location:e.location||e.location_data?.city,clientName:e.clientName||e.client_name||`Client #${e.user_id||e.client_id}`,createdAt:e.createdAt||e.created_at||new Date().toISOString(),status:e.status||"draft",urgency:e.urgency,bids:e.bids?e.bids.map(d):[],teamRequirements:e.teamRequirements||e.team_requirements}}function d(e){const r=e.amount?typeof e.amount=="string"?parseFloat(e.amount):e.amount:e.price?parseFloat(e.price):0;return{id:e.id,providerId:e.providerId||e.provider_id,providerName:e.providerName||e.provider_name,amount:r,price:`${r}€`,message:e.message,bid_type:e.bid_type,timeline_days:e.timeline_days,status:e.status}}function l(e){return{id:e.id,title:e.title||"",description:e.content||"",category:e.category||"",budgetMin:e.budgetMin||e.budget_min,budgetMax:e.budgetMax||e.budget_max,deadline:e.deadline?new Date(e.deadline):void 0,city:e.city||e.location,userId:e.userId||e.user_id,tags:e.tags||[],sponsored:e.sponsored||!1,qualityScore:e.qualityScore||e.quality_score||.8}}const p=c,u=e=>new Promise(r=>setTimeout(r,e)),g={async createFlashDeal(e){const r=await fetch("/api/services/flash-deals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw new Error("Erreur lors de la création du flash deal");return await r.json()},async createReverseSubscription(e){const r=await fetch("/api/services/subscriptions/reverse",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw new Error("Erreur lors de la création de l'abonnement inversé");return await r.json()},async createGroupRequest(e){const r=await fetch("/api/services/group-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw new Error("Erreur lors de la création de la demande groupée");return await r.json()},async getGroupInterest(e,r){const t=await fetch(`/api/services/group-requests/interest?location=${encodeURIComponent(e)}&category=${encodeURIComponent(r)}`);if(!t.ok)throw new Error("Erreur lors de la récupération de l'intérêt");return await t.json()},async aiDraftBrief(e){return await u(600),console.log("AI drafting brief for:",e),{scope:`Analyse du besoin : ${e.substring(0,100)}...`,deliverables:["Cahier des charges détaillé","Maquettes fonctionnelles","Planning de réalisation","Estimation budgétaire précise"],risks:["Délais serrés potentiels","Complexité technique à évaluer","Besoin de clarifications complémentaires"],checklist:["Validation du périmètre fonctionnel","Définition des critères d'acceptation","Planification des points de contrôle","Mise en place des outils de suivi"]}},async createIaHumanJob(e){const r=await fetch("/api/services/ia-human-jobs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw new Error("Erreur lors de la création du job IA+Humain");return await r.json()},async getLiveSlots(e={}){const r=new URLSearchParams;e.category&&r.append("category",e.category),e.minRating&&r.append("minRating",e.minRating.toString()),e.maxPrice&&r.append("maxPrice",e.maxPrice.toString()),e.location&&r.append("location",e.location);const t=await fetch(`/api/services/opportunities/live-slots?${r.toString()}`);if(!t.ok)throw new Error("Erreur lors de la récupération des créneaux");return await t.json()},async reserveSlot(e){const r=await fetch("/api/services/opportunities/reserve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slotId:e})});if(!r.ok)throw new Error("Erreur lors de la réservation du créneau");return await r.json()}},w={availability:{get:async(e,r,t)=>{const s=new URLSearchParams;r&&s.append("startDate",r),t&&s.append("endDate",t);const o=await fetch(`/api/availability/${e}?${s}`);if(!o.ok)throw new Error("Failed to fetch availability");return o.json()},save:async e=>{const r=await fetch("/api/availability",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({availability:e})});if(!r.ok)throw new Error("Failed to save availability");return r.json()},getSlots:async(e,r)=>{const t=await fetch(`/api/availability/slots/${e}/${r}`);if(!t.ok)throw new Error("Failed to fetch slots");return t.json()},deleteSlot:async e=>{const r=await fetch(`/api/availability/${e}`,{method:"DELETE"});if(!r.ok)throw new Error("Failed to delete slot");return r.json()},getRecurring:async e=>{const r=await fetch(`/api/availability/recurring/${e}`);if(!r.ok)throw new Error("Failed to fetch recurring availability");return r.json()},saveRecurring:async e=>{const r=await fetch("/api/availability/recurring",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw new Error("Failed to save recurring pattern");return r.json()}},feed:{async getMissions(){try{const e=await fetch("/api/missions",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});if(!e.ok){const i=await e.text();throw console.error("❌ Erreur API missions:",e.status,i),new Error(`Erreur ${e.status}: ${e.statusText}`)}const r=await e.json();let t=[],s={total:0};r.missions&&Array.isArray(r.missions)?(t=r.missions,s=r.metadata||{total:r.missions.length}):Array.isArray(r)&&(t=r,s={total:r.length});const o=t.map(i=>c(i));return console.log("✅ Missions normalisées avec mappers:",o.length),{missions:o,metadata:s}}catch(e){console.error("❌ Erreur réseau détaillée:",e);const r=e instanceof Error?e.message:JSON.stringify(e)||"Erreur de connexion inconnue";throw console.error("Type d'erreur:",typeof e),console.error("Stack:",e instanceof Error?e.stack:"N/A"),new Error(`Erreur réseau missions: ${r}`)}},async getUserMissions(e){const r=await fetch(`/api/missions/users/${e}/missions`);if(!r.ok){const o=await r.text();throw console.error("❌ Erreur API missions utilisateur:",r.status,o),new Error(`Erreur ${r.status}: ${r.statusText}`)}const s=(await r.json()).map(o=>c(o));return console.log("✅ Missions utilisateur normalisées:",s.length),s},async getUserBids(e){const r=await fetch(`/api/missions/users/${e}/bids`);if(!r.ok)throw new Error("Failed to fetch user bids");const s=(await r.json()).map(o=>d(o));return console.log("✅ Bids utilisateur normalisés:",s.length),s},async getMissionById(e){if(console.log("🔍 API Service - getMissionById appelé avec ID:",e),!e||e==="undefined"||e==="null")throw console.error("❌ API Service - ID invalide:",e),new Error("ID de mission invalide");const r=await fetch(`/api/missions/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("🔍 API Service - Réponse reçue:",r.status,r.statusText),!r.ok){const o=await r.text();throw console.error("❌ Erreur API mission:",r.status,o),new Error(`Erreur ${r.status}: ${r.statusText}`)}const t=await r.json();console.log("🔍 API Service - Données brutes reçues:",{id:t.id,title:t.title,hasBids:!!t.bids});const s=p(t);return console.log("✅ Mission normalisée:",s.title,"avec",s.bids?.length||0,"offres"),s},async getFeed(e,r=10){try{const t=new URLSearchParams({limit:r.toString()});e&&t.append("cursor",e);const s=await fetch(`/api/feed?${t}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",signal:AbortSignal.timeout(1e4)});if(!s.ok){const n=await s.text();throw console.error("❌ Erreur API feed:",s.status,n),new Error(`Erreur ${s.status}: ${n||"Impossible de charger le feed"}`)}const o=await s.json(),a=(o.items||[]).map(n=>l(n));return console.log("✅ Feed normalisé:",a.length,"annonces"),{items:a,hasMore:o.hasMore??a.length===r}}catch(t){throw console.error("❌ Erreur réseau feed:",t),new Error(t instanceof Error?t.message:"Erreur de connexion au feed")}},async getFavorites(e){const r=await fetch(`/api/favorites?user_id=${e}`);if(!r.ok)throw new Error("Erreur lors du chargement des favoris");const o=((await r.json()).favorites||[]).map(i=>l(i));return console.log("✅ Favoris normalisés:",o.length),o}}};export{w as d,g as s};
