import{r as g,j as e}from"./ui-BcXBiFQq.js";import{u as Z}from"./useQuery-WCz8JL_n.js";import{C as R,b as P,h as A,B as m,d as O,L as c,I as b,D as $,r as H,s as U,t as G,v as W,w as q}from"./index-_wxx-65m.js";import{B as J}from"./badge-nlmTjO3G.js";import{C as K}from"./calendar-Cej6GfLW.js";import{A as Q,a as X,b as Y}from"./avatar-C8B5sCrJ.js";import{T as ee}from"./textarea-BF7zclz6.js";import{S as v,a as y,b as N,c as S,d as r}from"./select-CUv1BqT8.js";import{C as se}from"./categories-x35FBw14.js";import{F as te}from"./filter-B3wS5egd.js";import{M as L}from"./map-pin-w368lGbv.js";import{E as ae}from"./euro-BsZCjycB.js";import{C as M}from"./calendar-D6X1UXLp.js";import{C as I}from"./clock-Dux5RWku.js";import{S as le}from"./star-G2g0Md8w.js";import{M as ie}from"./message-circle-DE4PR2-u.js";import{P as re}from"./phone-BOfQ2o3c.js";import"./vendor-D3F3s8fL.js";import"./chevron-left-CbePsjDb.js";import"./index-DIYLGAU4.js";import"./chevron-up-3UXFJfiV.js";function Re(){const[l,B]=g.useState(new Date),[w,z]=g.useState(!1),[i,h]=g.useState({category:"all",location:"",maxRate:"",availability:"all"}),[D,p]=g.useState({isOpen:!1,provider:null,selectedTimeSlot:""}),[n,x]=g.useState({date:"",timeSlot:"",duration:"1",description:"",budget:""}),{data:j=[],isLoading:ne}=Z({queryKey:["/api/providers/available"]}),u=new Date,C=new Date(u);C.setDate(u.getDate()+1),u.toISOString().split("T")[0],C.toISOString().split("T")[0],u.toISOString().split("T")[0],u.toISOString().split("T")[0],C.toISOString().split("T")[0];const F=j.length>0?j:[];console.log("🔍 Providers utilisés:",{fromAPI:j.length,using:F.length,source:j.length>0?"API":"Mock"});const f=F.filter(s=>{if(i.category!=="all"&&s.category!==i.category||i.location&&!s.location.toLowerCase().includes(i.location.toLowerCase())||i.maxRate&&s.hourlyRate>parseInt(i.maxRate))return!1;if(i.availability==="today"){const a=new Date().toISOString().split("T")[0];return s.availability.some(d=>d.date===a)}return!0}),T=(s,a)=>{if(!a||isNaN(a.getTime()))return[];const d=a.toISOString().split("T")[0];return s.availability.find(t=>t.date===d)?.timeSlots||[]},_=l&&!isNaN(l.getTime())?l.toISOString().split("T")[0]:new Date().toISOString().split("T")[0],k=f.filter(s=>s.availability.some(a=>a.date===_)),E=(s,a)=>{const d=l&&!isNaN(l.getTime())?l.toISOString().split("T")[0]:new Date().toISOString().split("T")[0];p({isOpen:!0,provider:s,selectedTimeSlot:""}),x({date:d,timeSlot:"",duration:"1",description:"",budget:""})},V=()=>{console.log("Réservation:",{provider:D.provider?.id,...n}),p({isOpen:!1,provider:null,selectedTimeSlot:""})};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Prestataires Disponibles"}),e.jsx("p",{className:"text-lg text-gray-600",children:"Trouvez des professionnels disponibles immédiatement avec leurs créneaux et tarifs"})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6 lg:sticky lg:top-6 lg:self-start",children:[e.jsxs(R,{className:"shadow-lg border-gray-200",children:[e.jsx(P,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(A,{className:"flex items-center text-lg",children:[e.jsx(te,{className:"w-5 h-5 mr-2 text-blue-600"}),"Filtres"]}),e.jsx(m,{onClick:()=>z(!w),variant:"ghost",size:"sm",className:"lg:hidden",children:w?e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})}),e.jsxs(O,{className:`space-y-4 ${w?"block":"hidden lg:block"}`,children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Catégorie"}),e.jsxs(v,{value:i.category,onValueChange:s=>h(a=>({...a,category:s})),children:[e.jsx(y,{children:e.jsx(N,{placeholder:"Toutes les catégories"})}),e.jsxs(S,{children:[e.jsx(r,{value:"all",children:"Toutes les catégories"}),se.map(s=>e.jsx(r,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Localisation"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(b,{placeholder:"Ville, région...",value:i.location,onChange:s=>h(a=>({...a,location:s.target.value})),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Tarif maximum"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(b,{type:"number",placeholder:"Budget par heure",value:i.maxRate,onChange:s=>h(a=>({...a,maxRate:s.target.value})),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Disponibilité"}),e.jsxs(v,{value:i.availability,onValueChange:s=>h(a=>({...a,availability:s})),children:[e.jsx(y,{children:e.jsx(N,{placeholder:"Période"})}),e.jsxs(S,{children:[e.jsx(r,{value:"all",children:"Toutes les disponibilités"}),e.jsx(r,{value:"today",children:"Aujourd'hui"}),e.jsx(r,{value:"week",children:"Cette semaine"})]})]})]}),e.jsx(m,{variant:"outline",size:"sm",className:"w-full",onClick:()=>h({category:"all",location:"",maxRate:"",availability:"all"}),children:"Réinitialiser"})]})]}),e.jsxs(R,{className:"shadow-lg border-gray-200",children:[e.jsx(P,{className:"pb-3",children:e.jsxs(A,{className:"flex items-center text-lg",children:[e.jsx(M,{className:"w-5 h-5 mr-2 text-purple-600"}),"Calendrier"]})}),e.jsxs(O,{className:"p-2",children:[e.jsx(K,{mode:"single",selected:l,onSelect:s=>s&&B(s),disabled:s=>s<new Date(new Date().setHours(0,0,0,0)),className:"rounded-md border-0 w-full",classNames:{months:"flex flex-col w-full",month:"w-full",caption:"flex justify-center pt-1 relative items-center mb-4",caption_label:"text-base font-semibold",nav:"space-x-1 flex items-center",nav_button:"h-8 w-8 bg-transparent p-0 opacity-70 hover:opacity-100 hover:bg-gray-100 rounded-md",table:"w-full border-collapse",head_row:"flex w-full",head_cell:"text-gray-500 rounded-md w-full font-medium text-xs flex-1",row:"flex w-full mt-1",cell:"text-center text-sm p-0 relative flex-1 focus-within:relative focus-within:z-20",day:"h-9 w-full p-0 font-normal hover:bg-blue-50 rounded-md transition-colors",day_selected:"bg-blue-600 text-white hover:bg-blue-700 focus:bg-blue-700",day_today:"bg-blue-100 text-blue-900 font-semibold",day_outside:"text-gray-300",day_disabled:"text-gray-300 opacity-50"}}),e.jsx("div",{className:"mt-4 p-3 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-100",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-800",children:[k.length," prestataire",k.length>1?"s":""]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["disponible",k.length>1?"s":""," le ",l.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})]})]})]})})]})]})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[f.length," prestataires trouvés"]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Triés par disponibilité et note"})]}),e.jsx("div",{className:"space-y-6",children:f.map(s=>{const a=T(s,new Date),d=T(s,l);return e.jsx(R,{className:"hover:shadow-lg transition-shadow",children:e.jsx(O,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4 mb-4 lg:mb-0",children:[e.jsxs(Q,{className:"w-16 h-16",children:[e.jsx(X,{src:s.avatar,alt:s.name}),e.jsx(Y,{children:s.name.split(" ").map(t=>t[0]).join("")})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"text-xl font-semibold",children:s.name}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"w-4 h-4 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-sm font-medium ml-1",children:s.rating})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),s.location]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),"Répond en ",s.responseTime]}),e.jsxs("div",{children:[s.completedProjects," projets"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:s.skills.map(t=>e.jsx(J,{variant:"secondary",className:"text-xs",children:t},t))}),e.jsxs("div",{className:"text-2xl font-bold text-green-600 mb-2",children:[s.hourlyRate,"€/h"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Dernier vu: ",s.lastSeen?new Date(s.lastSeen).toLocaleDateString():"Récemment"]}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Membre depuis ",s.memberSince?new Date(s.memberSince).getFullYear():"2024"]})]})]}),e.jsxs("div",{className:"lg:text-right space-y-3",children:[a.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-green-600 mb-1",children:"✅ Disponible aujourd'hui"}),e.jsx("div",{className:"text-xs text-gray-600",children:a.join(", ")})]}),d.length>0&&l.toDateString()!==new Date().toDateString()&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-blue-600 mb-1",children:["📅 Disponible le ",l.toLocaleDateString("fr-FR")]}),e.jsx("div",{className:"text-xs text-gray-600",children:d.join(", ")})]}),e.jsxs("div",{className:"flex space-x-2 flex-wrap",children:[e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>window.location.href=`/messages?provider=${s.id}`,children:[e.jsx(ie,{className:"w-4 h-4 mr-1"}),"Message"]}),e.jsxs(m,{size:"sm",variant:"outline",className:"border-green-600 text-green-600 hover:bg-green-50",onClick:()=>window.open(`tel:+33${Math.floor(Math.random()*1e9)}`,"_self"),children:[e.jsx(re,{className:"w-4 h-4 mr-1"}),"Contacter"]}),e.jsxs($,{open:D.isOpen&&D.provider?.id===s.id,onOpenChange:t=>!t&&p({isOpen:!1,provider:null,selectedTimeSlot:""}),children:[e.jsx(H,{asChild:!0,children:e.jsxs(m,{size:"sm",className:"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white",onClick:()=>E(s),children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Réserver"]})}),e.jsxs(U,{className:"max-w-md",children:[e.jsxs(G,{children:[e.jsx(W,{children:"Réserver un créneau"}),e.jsxs(q,{children:["Réservez un créneau avec ",s.name]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"date",children:"Date"}),e.jsx(b,{id:"date",type:"date",value:n.date,onChange:t=>x(o=>({...o,date:t.target.value})),min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"timeSlot",children:"Créneaux disponibles"}),e.jsxs(v,{value:n.timeSlot,onValueChange:t=>x(o=>({...o,timeSlot:t})),children:[e.jsx(y,{children:e.jsx(N,{placeholder:"Sélectionner un créneau"})}),e.jsx(S,{children:n.date&&T(s,new Date(n.date)).map(t=>e.jsx(r,{value:t,children:t},t))})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"duration",children:"Durée (heures)"}),e.jsxs(v,{value:n.duration,onValueChange:t=>x(o=>({...o,duration:t})),children:[e.jsx(y,{children:e.jsx(N,{})}),e.jsxs(S,{children:[e.jsx(r,{value:"1",children:"1 heure"}),e.jsx(r,{value:"2",children:"2 heures"}),e.jsx(r,{value:"4",children:"4 heures"}),e.jsx(r,{value:"8",children:"Journée complète"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"budget",children:"Budget estimé"}),e.jsx(b,{id:"budget",type:"number",placeholder:`${s.hourlyRate*parseInt(n.duration)}€`,value:n.budget,onChange:t=>x(o=>({...o,budget:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"description",children:"Description du projet"}),e.jsx(ee,{id:"description",placeholder:"Décrivez brièvement votre projet...",value:n.description,onChange:t=>x(o=>({...o,description:t.target.value}))})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(m,{variant:"outline",className:"flex-1",onClick:()=>p({isOpen:!1,provider:null,selectedTimeSlot:""}),children:"Annuler"}),e.jsx(m,{className:"flex-1 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",onClick:V,children:"Confirmer la réservation"})]})]})]})]})]})]})]})})},s.id)})}),f.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(I,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun prestataire disponible"}),e.jsx("p",{className:"text-gray-600",children:"Essayez de modifier vos critères de recherche"})]})]})]})]})}export{Re as default};
