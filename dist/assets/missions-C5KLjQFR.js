import{r as B,j as e}from"./ui-D9tbKjPW.js";import{u as f}from"./useQuery-BXvXNEAi.js";import{d as I,e as L,u as S,f as D,g as T,h as V,B as i,P as y,p as d,C as j,b as U,i as A,c as b,M as F}from"./index-UZk3kCW9.js";import{d as v}from"./services-B2lohCTD.js";import{f as $,a as N}from"./categories-CJOmrs8V.js";import{B as w}from"./badge-BqfO_1uT.js";import{C as P}from"./circle-alert-TNIQpHb9.js";import{E as R}from"./eye-B6-wmQBp.js";import{S as _}from"./square-pen-lxl-sbu0.js";import{T as H}from"./trash-2-BmG_oDpC.js";import{C as K}from"./clipboard-list-DggIILP7.js";import"./vendor-D3F3s8fL.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=I("Hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]);function ie(){const{user:t}=L(),[,n]=S(),[l,m]=B.useState("posted"),M=D(),{toast:x}=T(),{data:o=[],isLoading:p,error:C}=f({queryKey:["userMissions",t?.id],queryFn:async()=>{if(!t?.id)throw new Error("User ID manquant");console.log("ðŸ” RÃ©cupÃ©ration des missions pour user.id:",t.id);try{const{missions:s}=await v.feed.getMissions();console.log("ðŸ“Š Total missions rÃ©cupÃ©rÃ©es:",s.length);const r=s.filter(a=>{const z=a.user_id||parseInt(a.userId||"0")||parseInt(a.clientId||"0"),q=parseInt(t.id.toString()),g=z===q;return g&&console.log("âœ… Mission de l'utilisateur trouvÃ©e:",a.id,a.title),g});return console.log("âœ… Missions utilisateur filtrÃ©es:",r.length),r}catch(s){throw console.error("âŒ Erreur rÃ©cupÃ©ration missions utilisateur:",s),s}},enabled:!!t?.id,retry:2,retryDelay:1e3}),{data:c=[],isLoading:u}=f({queryKey:["userBids",t?.id],queryFn:async()=>{if(!t?.id)throw new Error("User ID manquant");console.log("ðŸ” RÃ©cupÃ©ration des bids avec mappers pour user.id:",t.id);const s=await v.getUserBids(t.id);return console.log("âœ… Bids normalisÃ©s rÃ©cupÃ©rÃ©s:",s.length),s},enabled:!!t&&t.type==="provider"}),h=V({mutationFn:async s=>{const r=await fetch(`/api/missions/${s}`,{method:"DELETE"});if(!r.ok)throw new Error("Failed to delete mission");return r.json()},onSuccess:()=>{M.invalidateQueries({queryKey:["userMissions"]}),x({title:"Mission supprimÃ©e",description:"Votre mission a Ã©tÃ© supprimÃ©e avec succÃ¨s."})},onError:s=>{x({title:"Erreur",description:"Impossible de supprimer la mission.",variant:"destructive"})}}),k=s=>{window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cette mission ?")&&h.mutate(s)},E=s=>{const r={published:{label:"PubliÃ©e",variant:"default"},open:{label:"Ouverte",variant:"default"},in_progress:{label:"En cours",variant:"secondary"},completed:{label:"TerminÃ©e",variant:"outline"},closed:{label:"FermÃ©e",variant:"destructive"}},a=r[s]||r.published;return e.jsx(w,{variant:a.variant,children:a.label})};return console.log("ðŸ‘¤ User actuel:",{id:t?.id,type:t?.type,name:t?.name}),console.log("ðŸ”— Mapping: user.id =",t?.id,"| client_id attendu:",t?.id),t?e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6 sm:mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 mb-1 sm:mb-2",children:"Mes Missions"}),e.jsx("p",{className:"text-base sm:text-lg text-gray-600",children:"GÃ©rez vos missions et consultez les offres reÃ§ues"})]}),e.jsxs(i,{onClick:()=>n(d.createMission),size:"lg",className:"w-full sm:w-auto",children:[e.jsx(y,{className:"mr-2 h-4 w-4 sm:h-5 sm:w-5"}),"Nouvelle Mission"]})]}),e.jsx("div",{className:"border-b border-gray-200 mb-8",children:e.jsxs("nav",{className:"-mb-px flex space-x-6 sm:space-x-8",children:[e.jsxs("button",{onClick:()=>m("posted"),className:`py-2 px-1 border-b-2 font-medium text-sm sm:text-base ${l==="posted"?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["Missions publiÃ©es (",o.length,")"]}),t.type==="provider"&&e.jsxs("button",{onClick:()=>m("bids"),className:`py-2 px-1 border-b-2 font-medium text-sm sm:text-base ${l==="bids"?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["Mes candidatures (",c.length,")"]})]})}),(p||u)&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Chargement..."})]}),C&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P,{className:"w-16 h-16 text-red-300 mx-auto mb-4"}),e.jsx("p",{className:"text-red-500 text-lg mb-4",children:"Erreur de chargement"}),e.jsx(i,{onClick:()=>window.location.reload(),variant:"outline",children:"RÃ©essayer"})]}),l==="posted"&&!p&&e.jsx("div",{className:"space-y-6",children:o.length>0?o.map(s=>e.jsxs(j,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(U,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(A,{className:"text-xl",children:s.title}),E(s.status||"published")]}),e.jsx("p",{className:"text-gray-600 text-sm sm:text-base",children:s.description})]}),e.jsxs("div",{className:"text-left sm:text-right",children:[e.jsx("div",{className:"text-xl font-bold text-primary",children:s.budgetDisplay}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:$(s.createdAt)})]})]})}),e.jsxs(b,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-gray-600",children:[e.jsxs("span",{children:["CatÃ©gorie: ",s.category]}),e.jsxs("span",{children:["Lieu: ",s.location||"Non spÃ©cifiÃ©"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.bids?.length||0," offre",(s.bids?.length||0)!==1?"s":""]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>n(`/missions/${s.id}`),className:"flex items-center gap-1",children:[e.jsx(R,{className:"w-4 h-4"}),"Voir les offres"]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>n(d.editMission(s.id?.toString()||"")),className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-4 h-4"}),"Modifier"]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>k(s.id),className:"flex items-center gap-1 text-red-600 hover:text-red-700",disabled:h.isPending,children:[e.jsx(H,{className:"w-4 h-4"}),"Supprimer"]})]})]}),s.bids&&s.bids.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"DerniÃ¨res offres reÃ§ues :"}),e.jsxs("div",{className:"space-y-2",children:[s.bids.slice(0,2).map(r=>e.jsxs("div",{className:"flex justify-between items-center text-sm bg-gray-50 p-2 rounded",children:[e.jsx("span",{className:"truncate flex-1",children:r.message||"Candidature soumise"}),e.jsx("span",{className:"font-medium text-primary ml-2",children:r.price||N(r.amount.toString())})]},r.id)),s.bids.length>2&&e.jsxs("p",{className:"text-xs text-gray-500",children:["+",s.bids.length-2," autre",s.bids.length-2>1?"s":""," offre",s.bids.length-2>1?"s":""]})]})]})]})]},s.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(K,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"Vous n'avez pas encore publiÃ© de missions"}),e.jsxs(i,{onClick:()=>n(d.createMission),className:"bg-primary hover:bg-primary-dark text-white",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"CrÃ©er ma premiÃ¨re mission"]})]})}),l==="bids"&&t.type==="provider"&&!u&&e.jsx("div",{className:"space-y-6",children:c.length>0?c.map(s=>e.jsx(j,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(b,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Candidature soumise"}),e.jsx("p",{className:"text-gray-600 mb-4 text-sm sm:text-base",children:s.message||"Aucun message fourni"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Votre offre:"}),e.jsx("span",{className:"text-xl font-bold text-primary ml-2",children:typeof s.amount=="string"?`${s.amount}â‚¬`:N(s.amount.toString())})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["DÃ©lai: ",s.timeline_days?`${s.timeline_days} jours`:"Non spÃ©cifiÃ©"]}),e.jsx(w,{variant:"secondary",children:"En attente"})]})]})]})},s.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"Vous n'avez pas encore postulÃ© Ã  des missions"}),e.jsx(i,{onClick:()=>n("/provider-profile"),className:"bg-primary hover:bg-primary-dark text-white",children:"DÃ©couvrir les missions"})]})})]}):e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Connexion requise"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Veuillez vous connecter pour voir vos missions"}),e.jsx(i,{onClick:()=>n("/"),children:"Retour Ã  l'accueil"})]})})}export{ie as default};
